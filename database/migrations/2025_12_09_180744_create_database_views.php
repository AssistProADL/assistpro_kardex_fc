<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Support\Facades\DB;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        $views = array (
  'v_administracioninventario_ao' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_administracioninventario_ao` AS select `inv`.`ID_Inventario` AS `consecutivo`,date_format(coalesce(`det`.`f_ini`,`inv`.`Fecha`),\\\'%d-%m-%Y %H:%i:%s\\\') AS `fecha_inicio`,case when `inv`.`Status` in (\\\'T\\\',\\\'O\\\') then date_format(coalesce(`det`.`f_fin`,`inv`.`Fecha`),\\\'%d-%m-%Y %H:%i:%s\\\') when `inv`.`Status` = \\\'A\\\' then \\\'--\\\' else date_format(coalesce(`det`.`f_fin`,`inv`.`Fecha`),\\\'%d-%m-%Y %H:%i:%s\\\') end AS `fecha_final`,`ap`.`nombre` AS `almacen`,`ca`.`des_almac` AS `zona`,coalesce(`usu_det`.`nombre_completo`,`usu_cnt`.`nombre_completo`,\\\'--\\\') AS `usuario`,case when `inv`.`Status` in (\\\'T\\\',\\\'O\\\') then \\\'Cerrado\\\' when `inv`.`Status` = \\\'A\\\' then \\\'Abierto\\\' else `inv`.`Status` end AS `status`,`det`.`piezas_contadas` AS `piezas_contadas`,`det`.`piezas_teoricas` AS `piezas_teoricas`,coalesce(`det`.`piezas_contadas`,0) - coalesce(`det`.`piezas_teoricas`,0) AS `diferencia` from ((((((`th_inventario` `inv` left join `c_almacenp` `ap` on(`ap`.`clave` = `inv`.`cve_almacen`)) left join `c_almacen` `ca` on(`ca`.`cve_almac` = `inv`.`cve_zona`)) left join (select `p`.`ID_Inventario` AS `ID_Inventario`,min(`p`.`fecha`) AS `f_ini`,max(`p`.`fecha`) AS `f_fin`,substring_index(group_concat(`p`.`cve_usuario` order by `p`.`fecha` DESC separator \\\',\\\'),\\\',\\\',1) AS `last_user_det`,sum(coalesce(`p`.`Cantidad`,0)) AS `piezas_contadas`,sum(coalesce(`p`.`ExistenciaTeorica`,0)) AS `piezas_teoricas` from `t_invpiezas` `p` group by `p`.`ID_Inventario`) `det` on(`det`.`ID_Inventario` = `inv`.`ID_Inventario`)) left join (select `t`.`ID_Inventario` AS `ID_Inventario`,substring_index(group_concat(`t`.`cve_usuario` order by `t`.`NConteo` DESC separator \\\',\\\'),\\\',\\\',1) AS `last_user_cnt` from `t_conteoinventario` `t` group by `t`.`ID_Inventario`) `cnt` on(`cnt`.`ID_Inventario` = `inv`.`ID_Inventario`)) left join `c_usuario` `usu_det` on(`usu_det`.`cve_usuario` = `det`.`last_user_det`)) left join `c_usuario` `usu_cnt` on(`usu_cnt`.`cve_usuario` = `cnt`.`last_user_cnt`)) where `inv`.`Activo` = 1 group by `inv`.`ID_Inventario`,`inv`.`Fecha`,`inv`.`Status`,`ap`.`nombre`,`ca`.`des_almac`,`usu_det`.`nombre_completo`,`usu_cnt`.`nombre_completo`,`det`.`f_ini`,`det`.`f_fin`,`det`.`piezas_contadas`,`det`.`piezas_teoricas`',
  'v_almacen_compat' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_almacen_compat` AS select `cap`.`cve_cia` AS `empresa_id`,`cap`.`id` AS `id`,`cap`.`clave` AS `clave`,`cap`.`nombre` AS `des_almac`,coalesce(`cap`.`BL`,\\\'\\\') AS `zona` from `c_almacenp` `cap`',
  'v_bi_eficiencia_entrada' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_bi_eficiencia_entrada` AS select cast(coalesce(`h`.`Fec_Entrada`,`d`.`fecha_inicio`) as date) AS `fecha`,`h`.`Cve_Almac` AS `Cve_Almac`,cast(trim(`h`.`Proyecto`) as char charset utf8mb4) AS `cve_proyecto`,cast(trim(`h`.`Cve_Proveedor`) as char charset utf8mb4) AS `cve_proveedor`,`h`.`Cve_Usuario` AS `cve_usuario`,count(0) AS `movs`,sum(coalesce(`d`.`CantidadRecibida`,0)) AS `uds_movidas`,round(sum(greatest(timestampdiff(SECOND,coalesce(`d`.`fecha_inicio`,`h`.`HoraInicio`),coalesce(`d`.`fecha_fin`,`h`.`HoraFin`)),0)) / 3600,2) AS `horas_trab`,round(count(0) / nullif(sum(greatest(timestampdiff(SECOND,coalesce(`d`.`fecha_inicio`,`h`.`HoraInicio`),coalesce(`d`.`fecha_fin`,`h`.`HoraFin`)),0)) / 3600,0),2) AS `movs_por_hora`,round(sum(coalesce(`d`.`CantidadRecibida`,0)) / nullif(sum(greatest(timestampdiff(SECOND,coalesce(`d`.`fecha_inicio`,`h`.`HoraInicio`),coalesce(`d`.`fecha_fin`,`h`.`HoraFin`)),0)) / 3600,0),2) AS `uds_por_hora`,round(avg(greatest(timestampdiff(SECOND,coalesce(`d`.`fecha_inicio`,`h`.`HoraInicio`),coalesce(`d`.`fecha_fin`,`h`.`HoraFin`)),0)) / 60,1) AS `tmi_min_prom` from (`th_entalmacen` `h` left join `td_entalmacen` `d` on(`d`.`empresa_id` = `h`.`empresa_id` and trim(`d`.`fol_folio`) = trim(`h`.`Fol_Folio`))) group by cast(coalesce(`h`.`Fec_Entrada`,`d`.`fecha_inicio`) as date),`h`.`Cve_Almac`,cast(trim(`h`.`Proyecto`) as char charset utf8mb4),`h`.`Cve_Proveedor`,`h`.`Cve_Usuario`',
  'v_bi_lote_proyecto' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_bi_lote_proyecto` AS select cast(trim(`d`.`cve_articulo`) as char charset utf8mb4) AS `cve_articulo`,cast(trim(`d`.`cve_lote`) as char charset utf8mb4) AS `lote`,min(coalesce(`d`.`fecha_inicio`,`h`.`HoraInicio`,`h`.`Fec_Entrada`)) AS `ts_primera_entrada`,cast(trim(`h`.`Proyecto`) as char charset utf8mb4) AS `cve_proyecto`,cast(trim(`h`.`Cve_Proveedor`) as char charset utf8mb4) AS `cve_proveedor` from (`th_entalmacen` `h` join `td_entalmacen` `d` on(trim(`d`.`fol_folio`) = trim(`h`.`Fol_Folio`))) where coalesce(`d`.`cve_lote`,\\\'\\\') <> \\\'\\\' group by cast(trim(`d`.`cve_articulo`) as char charset utf8mb4),cast(trim(`d`.`cve_lote`) as char charset utf8mb4),cast(trim(`h`.`Proyecto`) as char charset utf8mb4),cast(trim(`h`.`Cve_Proveedor`) as char charset utf8mb4)',
  'v_bi_proveedor' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_bi_proveedor` AS select cast(`lp`.`cve_proveedor` as char charset utf8mb4) AS `cve_proveedor`,cast(`lp`.`cve_proveedor` as char charset utf8mb4) AS `des_proveedor` from `v_bi_lote_proyecto` `lp` where coalesce(`lp`.`cve_proveedor`,\\\'\\\') <> \\\'\\\' group by 1,2',
  'v_bi_proyecto' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_bi_proyecto` AS select cast(`p`.`Cve_Proyecto` as char charset utf8mb4) AS `cve_proyecto`,cast(`p`.`Des_Proyecto` as char charset utf8mb4) AS `des_proyecto` from `c_proyecto` `p` union select cast(`lp`.`cve_proyecto` as char charset utf8mb4) AS `Name_exp_1`,cast(`lp`.`cve_proyecto` as char charset utf8mb4) AS `Name_exp_2` from `v_bi_lote_proyecto` `lp` where coalesce(`lp`.`cve_proyecto`,\\\'\\\') <> \\\'\\\'',
  'v_cobranza_aging' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_cobranza_aging` AS select `c`.`IdEmpresa` AS `IdEmpresa`,`c`.`Cliente` AS `Cliente`,sum(coalesce(`c`.`Saldo`,0)) AS `TotalSaldo`,sum(case when `c`.`Saldo` > 0 and `c`.`FechaVence` is not null and to_days(curdate()) - to_days(`c`.`FechaVence`) <= 0 then `c`.`Saldo` else 0 end) AS `Bucket_0`,sum(case when `c`.`Saldo` > 0 and `c`.`FechaVence` is not null and to_days(curdate()) - to_days(`c`.`FechaVence`) between 1 and 30 then `c`.`Saldo` else 0 end) AS `Bucket_1_30`,sum(case when `c`.`Saldo` > 0 and `c`.`FechaVence` is not null and to_days(curdate()) - to_days(`c`.`FechaVence`) between 31 and 60 then `c`.`Saldo` else 0 end) AS `Bucket_31_60`,sum(case when `c`.`Saldo` > 0 and `c`.`FechaVence` is not null and to_days(curdate()) - to_days(`c`.`FechaVence`) between 61 and 90 then `c`.`Saldo` else 0 end) AS `Bucket_61_90`,sum(case when `c`.`Saldo` > 0 and `c`.`FechaVence` is not null and to_days(curdate()) - to_days(`c`.`FechaVence`) between 91 and 120 then `c`.`Saldo` else 0 end) AS `Bucket_91_120`,sum(case when `c`.`Saldo` > 0 and `c`.`FechaVence` is not null and to_days(curdate()) - to_days(`c`.`FechaVence`) > 120 then `c`.`Saldo` else 0 end) AS `Bucket_121_Mas` from `cobranza` `c` group by `c`.`IdEmpresa`,`c`.`Cliente`',
  'v_cobranza_analitico' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_cobranza_analitico` AS select `c`.`id` AS `id`,`c`.`IdEmpresa` AS `IdEmpresa`,`c`.`Cliente` AS `IdDestinatario`,`d`.`id_destinatario` AS `id_destinatario`,`d`.`Cve_Clte` AS `Cve_Clte`,`cli`.`id_cliente` AS `id_cliente`,`cli`.`RazonSocial` AS `RazonSocial`,`cli`.`RazonComercial` AS `RazonComercial`,`c`.`Documento` AS `Documento`,`c`.`TipoDoc` AS `TipoDoc`,`c`.`FolioInterno` AS `FolioInterno`,`c`.`Saldo` AS `Saldo`,`c`.`Status` AS `Status`,`c`.`RutaId` AS `RutaId`,`r`.`descripcion` AS `RutaDescripcion`,`c`.`UltPago` AS `UltPago`,`c`.`FechaReg` AS `FechaReg`,`c`.`FechaVence` AS `FechaVence`,`c`.`DiaO` AS `DiaO`,case when `c`.`FechaVence` is null then NULL else to_days(curdate()) - to_days(`c`.`FechaVence`) end AS `DiasAtraso`,case when `c`.`Saldo` is null then \\\'SIN_DATOS\\\' when `c`.`Saldo` <= 0 then \\\'PAGADO\\\' when `c`.`FechaVence` is null then \\\'SIN_VENCIMIENTO\\\' when `c`.`FechaVence` >= curdate() then \\\'VIGENTE\\\' else \\\'VENCIDO\\\' end AS `EstatusTexto`,case when `c`.`FechaVence` is null or `c`.`Saldo` <= 0 then \\\'SIN_RIESGO\\\' when to_days(curdate()) - to_days(`c`.`FechaVence`) <= 0 then \\\'0-0\\\' when to_days(curdate()) - to_days(`c`.`FechaVence`) between 1 and 30 then \\\'1-30\\\' when to_days(curdate()) - to_days(`c`.`FechaVence`) between 31 and 60 then \\\'31-60\\\' when to_days(curdate()) - to_days(`c`.`FechaVence`) between 61 and 90 then \\\'61-90\\\' when to_days(curdate()) - to_days(`c`.`FechaVence`) between 91 and 120 then \\\'91-120\\\' else \\\'121+\\\' end AS `RangoAntiguedad`,case when `c`.`FechaReg` is null then NULL else date_format(`c`.`FechaReg`,\\\'%Y-%m\\\') end AS `PeriodoMes` from (((`cobranza` `c` left join `c_destinatarios` `d` on(`d`.`id_destinatario` = `c`.`Cliente`)) left join `c_cliente` `cli` on(`cli`.`Cve_Clte` = `d`.`Cve_Clte`)) left join `t_ruta` `r` on(`r`.`ID_Ruta` = `c`.`RutaId`))',
  'v_cobranza_resumen_empresa' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_cobranza_resumen_empresa` AS select `c`.`IdEmpresa` AS `IdEmpresa`,count(0) AS `Documentos`,sum(coalesce(`c`.`Saldo`,0)) AS `TotalSaldo`,sum(case when `c`.`Saldo` > 0 and `c`.`FechaVence` is not null and `c`.`FechaVence` < curdate() then `c`.`Saldo` else 0 end) AS `CarteraVencida`,sum(case when `c`.`Saldo` > 0 and `c`.`FechaVence` is not null and `c`.`FechaVence` >= curdate() then `c`.`Saldo` else 0 end) AS `CarteraVigente` from `cobranza` `c` group by `c`.`IdEmpresa`',
  'v_crm_actividades_pendientes' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_crm_actividades_pendientes` AS select `a`.`id_act` AS `id_act`,`a`.`id_lead` AS `id_lead`,`a`.`id_opp` AS `id_opp`,`a`.`tipo` AS `tipo`,`a`.`descripcion` AS `descripcion`,`a`.`fecha_programada` AS `fecha_programada`,`a`.`fecha_realizada` AS `fecha_realizada`,`a`.`usuario` AS `usuario`,`a`.`estatus` AS `estatus`,`a`.`fecha_crea` AS `fecha_crea`,`l`.`nombre_contacto` AS `nombre_contacto`,`o`.`titulo` AS `oportunidad` from ((`t_crm_actividad` `a` left join `t_crm_lead` `l` on(`l`.`id_lead` = `a`.`id_lead`)) left join `t_crm_oportunidad` `o` on(`o`.`id_opp` = `a`.`id_opp`)) where `a`.`estatus` = \\\'Programada\\\' order by `a`.`fecha_programada`',
  'v_crm_conversion' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_crm_conversion` AS select sum(`t_crm_oportunidad`.`etapa` = \\\'Ganada\\\') AS `ganadas`,sum(`t_crm_oportunidad`.`etapa` = \\\'Perdida\\\') AS `perdidas`,sum(`t_crm_oportunidad`.`etapa` = \\\'Ganada\\\') / count(0) * 100 AS `conversion_pct` from `t_crm_oportunidad`',
  'v_crm_funnel' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_crm_funnel` AS select `t_crm_oportunidad`.`etapa` AS `etapa`,count(0) AS `total`,sum(`t_crm_oportunidad`.`valor_estimado` * (`t_crm_oportunidad`.`probabilidad` / 100)) AS `forecast` from `t_crm_oportunidad` where `t_crm_oportunidad`.`etapa` in (\\\'Prospecci贸n\\\',\\\'Propuesta\\\',\\\'Cotizado\\\',\\\'Negociaci贸n\\\') group by `t_crm_oportunidad`.`etapa`',
  'v_crm_ventas_plataforma' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_crm_ventas_plataforma` AS select `p`.`Fol_folio` AS `folio`,`p`.`Fec_Pedido` AS `fecha_pedido`,`f`.`id` AS `fuente_id`,`f`.`clave` AS `plataforma`,`f`.`descripcion` AS `plataforma_desc`,`p`.`fuente_detalle` AS `fuente_detalle`,`p`.`Cve_clte` AS `cve_cliente`,`cli`.`id_cliente` AS `cliente_id`,`cli`.`RazonSocial` AS `cliente`,`d`.`id` AS `pedido_det_id`,`d`.`Cve_articulo` AS `sku`,`d`.`cve_lote` AS `lote`,`d`.`Num_cantidad` AS `cantidad`,`d`.`Precio_unitario` AS `precio_unitario`,`d`.`Num_cantidad` * `d`.`Precio_unitario` AS `subtotal`,`d`.`Desc_Importe` AS `descuento`,`d`.`IVA` AS `iva_importe`,`d`.`Num_cantidad` * `d`.`Precio_unitario` - ifnull(`d`.`Desc_Importe`,0) + ifnull(`d`.`IVA`,0) AS `total_renglon`,`p`.`status` AS `estado_pedido` from (((`th_pedido` `p` join `td_pedido` `d` on(`d`.`Fol_folio` = `p`.`Fol_folio`)) left join `c_cliente` `cli` on(`cli`.`Cve_Clte` = `p`.`Cve_clte`)) left join `c_pedido_fuente` `f` on(`f`.`id` = `p`.`fuente_id`))',
  'v_dashboard_inv_ciclico_ao' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_dashboard_inv_ciclico_ao` AS select `p`.`ID_PLAN` AS `folio_plan`,`p`.`FECHA_INI` AS `fecha_inicio`,`p`.`FECHA_FIN` AS `fecha_fin`,`p`.`Activo` AS `Activo`,`ap`.`id` AS `id_almacen`,`ap`.`clave` AS `cve_almacen`,`ap`.`nombre` AS `des_almacen`,count(distinct `uinv`.`idy_ubica`) AS `ubicaciones_planeadas`,count(distinct `pz`.`idy_ubica`) AS `ubicaciones_contadas`,case when count(distinct `uinv`.`idy_ubica`) = 0 then 0 else round(count(distinct `pz`.`idy_ubica`) / count(distinct `uinv`.`idy_ubica`) * 100,2) end AS `avance_porcentual`,sum(coalesce(`pz`.`Cantidad`,0)) AS `piezas_contadas`,sum(coalesce(`pz`.`ExistenciaTeorica`,0)) AS `piezas_teoricas`,sum(coalesce(`pz`.`Cantidad`,0)) - sum(coalesce(`pz`.`ExistenciaTeorica`,0)) AS `diferencia_piezas`,case when `p`.`Activo` = 0 then \\\'Cerrado\\\' when count(distinct `pz`.`idy_ubica`) = 0 then \\\'Planeado\\\' when count(distinct `pz`.`idy_ubica`) < count(distinct `uinv`.`idy_ubica`) then \\\'En ejecuci贸n\\\' else \\\'Completado\\\' end AS `estado_proceso` from (((`cab_planifica_inventario` `p` join `c_almacenp` `ap` on(`ap`.`id` = `p`.`id_almacen`)) left join `ubicacionesinventareadas` `uinv` on(`uinv`.`ID_PLAN` = `p`.`ID_PLAN`)) left join `t_invpiezasciclico` `pz` on(`pz`.`ID_PLAN` = `p`.`ID_PLAN`)) group by `p`.`ID_PLAN`,`p`.`FECHA_INI`,`p`.`FECHA_FIN`,`p`.`Activo`,`ap`.`id`,`ap`.`clave`,`ap`.`nombre` order by `p`.`FECHA_INI` desc',
  'v_dashboard_inv_fisico_ao' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_dashboard_inv_fisico_ao` AS select `a`.`consecutivo` AS `folio_inventario`,`a`.`fecha_inicio` AS `fecha_creacion`,concat(\\\'INV \\\',`a`.`consecutivo`) AS `nombre_inventario`,`a`.`status` AS `status_inventario`,(select `c`.`cve_almac` from `c_almacen` `c` where ucase(trim(`c`.`des_almac`)) = ucase(trim(`a`.`almacen`)) limit 1) AS `cve_almacen`,`a`.`almacen` AS `almacen`,`a`.`zona` AS `cve_zona`,count(distinct `uai`.`idy_ubica`) AS `ubicaciones_planeadas`,count(distinct `ui`.`idy_ubica`) AS `ubicaciones_contadas`,case when count(distinct `uai`.`idy_ubica`) = 0 then 0 else round(count(distinct `ui`.`idy_ubica`) / count(distinct `uai`.`idy_ubica`) * 100,2) end AS `avance_porcentual`,sum(coalesce(`p`.`Cantidad`,0)) AS `piezas_contadas`,sum(coalesce(`p`.`ExistenciaTeorica`,0)) AS `piezas_teoricas`,sum(coalesce(`p`.`Cantidad`,0)) - sum(coalesce(`p`.`ExistenciaTeorica`,0)) AS `diferencia_piezas`,case when `a`.`status` = \\\'Cerrado\\\' then \\\'Cerrado\\\' when count(distinct `ui`.`idy_ubica`) = 0 then \\\'Planeado\\\' when count(distinct `ui`.`idy_ubica`) < count(distinct `uai`.`idy_ubica`) then \\\'En ejecuci贸n\\\' else \\\'Completado\\\' end AS `estado_proceso` from (((`v_administracioninventario_ao` `a` left join `t_ubicacionesainventariar` `uai` on(`uai`.`ID_Inventario` = `a`.`consecutivo`)) left join `t_ubicacioninventario` `ui` on(`ui`.`ID_Inventario` = `a`.`consecutivo`)) left join `t_invpiezas` `p` on(`p`.`ID_Inventario` = `a`.`consecutivo`)) group by `a`.`consecutivo`,`a`.`fecha_inicio`,`a`.`status`,`a`.`almacen`,`a`.`zona` order by `a`.`fecha_inicio` desc',
  'v_dashboard_inv_fisico_fast_ao' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_dashboard_inv_fisico_fast_ao` AS select `inv`.`ID_Inventario` AS `folio_inventario`,`inv`.`Fecha` AS `fecha_creacion`,`ap`.`nombre` AS `almacen`,`ca`.`des_almac` AS `zona`,case when `inv`.`Status` in (\\\'T\\\',\\\'O\\\') then \\\'Cerrado\\\' when `inv`.`Status` = \\\'A\\\' then \\\'Abierto\\\' else `inv`.`Status` end AS `status_inventario`,coalesce(`uai`.`ubic_plan`,0) AS `ubicaciones_planeadas`,coalesce(`ui`.`ubic_cont`,0) AS `ubicaciones_contadas`,case when coalesce(`uai`.`ubic_plan`,0) = 0 then 0 else round(coalesce(`ui`.`ubic_cont`,0) * 100.0 / `uai`.`ubic_plan`,2) end AS `avance_porcentual`,coalesce(`det`.`piezas_contadas`,0) AS `piezas_contadas`,coalesce(`det`.`piezas_teoricas`,0) AS `piezas_teoricas`,coalesce(`det`.`piezas_contadas`,0) - coalesce(`det`.`piezas_teoricas`,0) AS `diferencia_piezas` from (((((`th_inventario` `inv` left join `c_almacenp` `ap` on(`ap`.`clave` = `inv`.`cve_almacen`)) left join `c_almacen` `ca` on(`ca`.`cve_almac` = `inv`.`cve_zona`)) left join (select `t_invpiezas`.`ID_Inventario` AS `ID_Inventario`,sum(coalesce(`t_invpiezas`.`Cantidad`,0)) AS `piezas_contadas`,sum(coalesce(`t_invpiezas`.`ExistenciaTeorica`,0)) AS `piezas_teoricas` from `t_invpiezas` group by `t_invpiezas`.`ID_Inventario`) `det` on(`det`.`ID_Inventario` = `inv`.`ID_Inventario`)) left join (select `t_ubicacionesainventariar`.`ID_Inventario` AS `ID_Inventario`,count(distinct `t_ubicacionesainventariar`.`idy_ubica`) AS `ubic_plan` from `t_ubicacionesainventariar` group by `t_ubicacionesainventariar`.`ID_Inventario`) `uai` on(`uai`.`ID_Inventario` = `inv`.`ID_Inventario`)) left join (select `t_ubicacioninventario`.`ID_Inventario` AS `ID_Inventario`,count(distinct `t_ubicacioninventario`.`idy_ubica`) AS `ubic_cont` from `t_ubicacioninventario` group by `t_ubicacioninventario`.`ID_Inventario`) `ui` on(`ui`.`ID_Inventario` = `inv`.`ID_Inventario`)) where `inv`.`Activo` = 1',
  'v_dispositivos' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_dispositivos` AS select `d`.`id` AS `id`,`d`.`id_almacen` AS `id_almacen`,`a`.`clave` AS `almacen_clave`,`a`.`nombre` AS `almacen_nombre`,`d`.`tipo` AS `tipo`,`d`.`marca` AS `marca`,`d`.`modelo` AS `modelo`,`d`.`serie` AS `serie`,`d`.`imei` AS `imei`,`d`.`mac_wifi` AS `mac_wifi`,`d`.`mac_bt` AS `mac_bt`,`d`.`ip` AS `ip`,`d`.`usuario_asignado` AS `usuario_asignado`,`d`.`estatus` AS `estatus`,`d`.`fecha_alta` AS `fecha_alta` from (`s_dispositivos` `d` left join `c_almacenp` `a` on(`a`.`id` = `d`.`id_almacen`))',
  'v_ecommerce_articulos' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_ecommerce_articulos` AS select `a`.`id` AS `id`,`a`.`cve_articulo` AS `cve_articulo`,`a`.`des_articulo` AS `des_articulo`,`lp`.`id` AS `ListaId`,`lp`.`Lista` AS `NombreLista`,`dp`.`PrecioMin` AS `PrecioLista`,`a`.`ecommerce_categoria` AS `ecommerce_categoria`,`a`.`ecommerce_subcategoria` AS `ecommerce_subcategoria`,`a`.`ecommerce_img_principal` AS `ecommerce_img_principal`,`a`.`ecommerce_img_galeria` AS `ecommerce_img_galeria`,`a`.`ecommerce_tags` AS `ecommerce_tags`,`a`.`ecommerce_destacado` AS `ecommerce_destacado` from ((`c_articulo` `a` left join `detallelp` `dp` on(`dp`.`Cve_Articulo` = `a`.`cve_articulo`)) left join `listap` `lp` on(`lp`.`id` = `dp`.`ListaId`)) where ifnull(`a`.`ecommerce_activo`,0) = 1',
  'v_ecommerce_precios' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_ecommerce_precios` AS select `d`.`Cve_Articulo` AS `Cve_Articulo`,`d`.`PrecioMin` AS `PrecioMin`,`d`.`PrecioMax` AS `PrecioMax`,`d`.`ListaId` AS `ListaId`,`lp`.`Lista` AS `Lista`,`lp`.`FechaIni` AS `FechaIni`,`lp`.`FechaFin` AS `FechaFin`,`lp`.`Cve_Almac` AS `Cve_Almac`,`lp`.`id_moneda` AS `id_moneda` from (`detallelp` `d` join `listap` `lp` on(`lp`.`id` = `d`.`ListaId`)) where `lp`.`Lista` = \\\'e-commerce\\\' and (`lp`.`FechaIni` is null or `lp`.`FechaIni` = \\\'0000-00-00\\\' or `lp`.`FechaIni` <= curdate()) and (`lp`.`FechaFin` is null or `lp`.`FechaFin` = \\\'0000-00-00\\\' or `lp`.`FechaFin` >= curdate())',
  'v_existencias_por_ubicacion_ao' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_existencias_por_ubicacion_ao` AS select --------------------------------------------------------------------------------------------------------------------------------`e`.`cve_almac` AS `cve_almac`,`u`.`idy_ubica` AS `idy_ubica`,`u`.`CodigoCSD` AS `bl`,`u`.`cve_pasillo` AS `pasillo`,`u`.`cve_rack` AS `rack`,`u`.`cve_nivel` AS `nivel`,`u`.`Status` AS `status_ubicacion`,`u`.`picking` AS `es_picking`,`e`.`cve_articulo` AS `cve_articulo`,`art`.`des_articulo` AS `des_articulo`,`art`.`control_lotes` AS `control_lotes`,`art`.`control_numero_series` AS `control_numero_series`,`art`.`Caduca` AS `Caduca`,case when `art`.`control_numero_series` = \\\'S\\\' then \\\'SERIE\\\' when `art`.`control_lotes` = \\\'S\\\' then \\\'LOTE\\\' else \\\'SIN_CONTROL\\\' end AS `tipo_control`,`e`.`cve_lote` AS `cve_lote`,`l`.`Caducidad` AS `Caducidad`,`e`.`Lote_Alterno` AS `Lote_Alterno`,`e`.`Existencia` AS `existencia`,`e`.`Cuarentena` AS `es_qa`,case when `e`.`Cuarentena` = 1 then 0 else `e`.`Existencia` end AS `disponible`,case when `e`.`Existencia` = 0 then \\\'LIBRE\\\' else \\\'OCUPADO\\\' end AS `estado_bl`,`e`.`Cve_Contenedor` AS `Cve_Contenedor`,`ch`.`CveLP` AS `CveLP`,--------------------------------------------------------------------------------------------------------------------------------`a`.`cve_almac` AS `id_almacen`,`a`.`clave_almacen` AS `clave_almacen`,`a`.`des_almac` AS `des_almac`,`a`.`Cve_TipoZona` AS `zona_almacen`,--------------------------------------------------------------------------------------------------------------------------------cast(`ap`.`cve_cia` as signed) AS `empresa_id`,`cia`.`des_cia` AS `empresa_nombre`,`cia`.`clave_empresa` AS `empresa_clave`,`cia`.`des_rfc` AS `empresa_rfc`,`cia`.`distrito` AS `empresa_distrito`,--------------------------------------------------------------------------------------------------------------------------------`u`.`Seccion` AS `seccion`,`u`.`Ubicacion` AS `posicion`,`u`.`orden_secuencia` AS `orden_secuencia`,`u`.`PesoMaximo` AS `peso_maximo`,`u`.`PesoOcupado` AS `peso_ocupado`,`u`.`TECNOLOGIA` AS `tecnologia`,`u`.`Maneja_Cajas` AS `maneja_cajas`,`u`.`Maneja_Piezas` AS `maneja_piezas`,`u`.`Reabasto` AS `reabasto`,`u`.`Tipo` AS `tipo_ubicacion`,`u`.`AcomodoMixto` AS `acomodo_mixto`,`u`.`AreaProduccion` AS `area_produccion`,`u`.`AreaStagging` AS `area_stagging`,`u`.`Ptl` AS `ptl`,`u`.`Maximo` AS `maximo`,`u`.`Minimo` AS `minimo`,`u`.`clasif_abc` AS `clasif_abc` from (((((((`mv_existencia_gral` `e` join `c_ubicacion` `u` on(`u`.`idy_ubica` = `e`.`cve_ubicacion`)) join `c_articulo` `art` on(`art`.`cve_articulo` = `e`.`cve_articulo` and `art`.`cve_almac` = `e`.`cve_almac`)) left join `c_lotes` `l` on(`l`.`cve_articulo` = `e`.`cve_articulo` and `l`.`Lote` = `e`.`cve_lote`)) left join `c_charolas` `ch` on(`ch`.`cve_almac` = `e`.`cve_almac` and `ch`.`Clave_Contenedor` = `e`.`Cve_Contenedor`)) left join `c_almacen` `a` on(`a`.`cve_almac` = `e`.`cve_almac`)) left join `c_almacenp` `ap` on(`ap`.`id` = `a`.`cve_almacenp`)) left join `c_compania` `cia` on(`cia`.`cve_cia` = cast(`ap`.`cve_cia` as signed)))',
  'v_impresoras' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_impresoras` AS select `i`.`id` AS `id`,`i`.`id_almacen` AS `id_almacen`,`a`.`clave` AS `almacen_clave`,`a`.`nombre` AS `almacen_nombre`,`i`.`IP` AS `IP`,`i`.`TIPO_IMPRESORA` AS `TIPO_IMPRESORA`,`i`.`NOMBRE` AS `NOMBRE`,`i`.`Marca` AS `Marca`,`i`.`Modelo` AS `Modelo`,`i`.`Densidad_Imp` AS `Densidad_Imp`,`i`.`TIPO_CONEXION` AS `TIPO_CONEXION`,`i`.`PUERTO` AS `PUERTO`,`i`.`TiempoEspera` AS `TiempoEspera`,`i`.`Activo` AS `Activo` from (`s_impresoras` `i` left join `c_almacenp` `a` on(`a`.`id` = `i`.`id_almacen`))',
  'v_inv_ciclico_detalle_ao' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_inv_ciclico_detalle_ao` AS select `t`.`ID_PLAN` AS `folio_plan`,`t`.`NConteo` AS `NConteo`,`t`.`idy_ubica` AS `idy_ubica`,`t`.`cve_articulo` AS `cve_articulo`,`t`.`cve_lote` AS `cve_lote`,\\\'PIEZA\\\' AS `tipo_unidad`,NULL AS `piezas_x_caja`,`t`.`Cantidad` AS `cantidad_conteo`,`t`.`ExistenciaTeorica` AS `existencia_teorica`,coalesce(`t`.`Cantidad`,0) - coalesce(`t`.`ExistenciaTeorica`,0) AS `diferencia_piezas`,`t`.`Id_Proveedor` AS `Id_Proveedor`,`t`.`Cuarentena` AS `Cuarentena`,`t`.`ClaveEtiqueta` AS `ClaveEtiqueta`,`t`.`cve_usuario` AS `cve_usuario`,`t`.`fecha` AS `fecha` from `t_invpiezasciclico` `t`',
  'v_inv_ciclico_diferencias_det' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_inv_ciclico_diferencias_det` AS select `t`.`ID_PLAN` AS `folio_plan`,`t`.`NConteo` AS `NConteo`,`t`.`idy_ubica` AS `idy_ubica`,`t`.`cve_articulo` AS `cve_articulo`,`art`.`des_articulo` AS `des_articulo`,`t`.`cve_lote` AS `cve_lote`,`t`.`Cantidad` AS `cantidad_conteo`,`t`.`ExistenciaTeorica` AS `ExistenciaTeorica`,coalesce(`t`.`Cantidad`,0) - coalesce(`t`.`ExistenciaTeorica`,0) AS `diferencia_piezas`,coalesce(`art`.`costoPromedio`,`art`.`imp_costo`,0) AS `costo_unitario`,(coalesce(`t`.`Cantidad`,0) - coalesce(`t`.`ExistenciaTeorica`,0)) * coalesce(`art`.`costoPromedio`,`art`.`imp_costo`,0) AS `diferencia_valor`,`t`.`Id_Proveedor` AS `Id_Proveedor`,`t`.`Cuarentena` AS `Cuarentena`,`t`.`ClaveEtiqueta` AS `ClaveEtiqueta`,`t`.`cve_usuario` AS `cve_usuario`,`t`.`fecha` AS `fecha` from (`t_invpiezasciclico` `t` left join `c_articulo` `art` on(`art`.`cve_articulo` = `t`.`cve_articulo`))',
  'v_inv_conteos_multinivel' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_inv_conteos_multinivel` AS select \\\'PZ\\\' AS `nivel`,`p`.`ID_Inventario` AS `ID_Inventario`,`p`.`NConteo` AS `NConteo`,`p`.`idy_ubica` AS `idy_ubica`,`u`.`CodigoCSD` AS `bl`,`p`.`cve_articulo` AS `cve_articulo`,`p`.`cve_lote` AS `cve_lote`,NULL AS `Id_Caja`,NULL AS `nTarima`,`p`.`Cantidad` AS `cantidad`,`p`.`cve_usuario` AS `cve_usuario`,`p`.`fecha` AS `fecha`,\\\'t_invpiezas\\\' AS `fuente` from (`t_invpiezas` `p` join `c_ubicacion` `u` on(`u`.`idy_ubica` = `p`.`idy_ubica`)) union all select \\\'CT\\\' AS `nivel`,`c`.`ID_Inventario` AS `ID_Inventario`,`c`.`NConteo` AS `NConteo`,`c`.`idy_ubica` AS `idy_ubica`,`u`.`CodigoCSD` AS `bl`,`c`.`cve_articulo` AS `cve_articulo`,`c`.`cve_lote` AS `cve_lote`,`c`.`Id_Caja` AS `Id_Caja`,`c`.`nTarima` AS `nTarima`,`c`.`Cantidad` AS `cantidad`,`c`.`cve_usuario` AS `cve_usuario`,`c`.`fecha` AS `fecha`,\\\'t_invcajas\\\' AS `fuente` from (`t_invcajas` `c` join `c_ubicacion` `u` on(`u`.`idy_ubica` = `c`.`idy_ubica`)) union all select \\\'LP\\\' AS `nivel`,`t`.`ID_Inventario` AS `ID_Inventario`,`t`.`NConteo` AS `NConteo`,`t`.`idy_ubica` AS `idy_ubica`,`u`.`CodigoCSD` AS `bl`,`t`.`cve_articulo` AS `cve_articulo`,`t`.`Cve_Lote` AS `cve_lote`,NULL AS `Id_Caja`,`t`.`ntarima` AS `nTarima`,`t`.`existencia` AS `cantidad`,`t`.`cve_usuario` AS `cve_usuario`,`t`.`fecha` AS `fecha`,\\\'t_invtarima\\\' AS `fuente` from (`t_invtarima` `t` join `c_ubicacion` `u` on(`u`.`idy_ubica` = `t`.`idy_ubica`))',
  'v_inv_existencia_multinivel' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_inv_existencia_multinivel` AS select \\\'PZ\\\' AS `nivel`,`p`.`cve_almac` AS `cve_almac`,`p`.`idy_ubica` AS `idy_ubica`,`u`.`CodigoCSD` AS `bl`,`p`.`cve_articulo` AS `cve_articulo`,`p`.`cve_lote` AS `cve_lote`,NULL AS `Id_Caja`,NULL AS `nTarima`,`p`.`Existencia` AS `cantidad`,`p`.`epc` AS `epc`,`p`.`code` AS `code`,\\\'ts_existenciapiezas\\\' AS `fuente` from (`ts_existenciapiezas` `p` join `c_ubicacion` `u` on(`u`.`idy_ubica` = `p`.`idy_ubica`)) union all select \\\'CT\\\' AS `nivel`,`c`.`Cve_Almac` AS `cve_almac`,`c`.`idy_ubica` AS `idy_ubica`,`u`.`CodigoCSD` AS `bl`,`c`.`cve_articulo` AS `cve_articulo`,`c`.`cve_lote` AS `cve_lote`,`c`.`Id_Caja` AS `Id_Caja`,`c`.`nTarima` AS `nTarima`,`c`.`PiezasXCaja` AS `cantidad`,`c`.`epc` AS `epc`,`c`.`code` AS `code`,\\\'ts_existenciacajas\\\' AS `fuente` from (`ts_existenciacajas` `c` join `c_ubicacion` `u` on(`u`.`idy_ubica` = `c`.`idy_ubica`)) union all select \\\'LP\\\' AS `nivel`,`t`.`cve_almac` AS `cve_almac`,`t`.`idy_ubica` AS `idy_ubica`,`u`.`CodigoCSD` AS `bl`,`t`.`cve_articulo` AS `cve_articulo`,`t`.`lote` AS `cve_lote`,NULL AS `Id_Caja`,`t`.`ntarima` AS `nTarima`,`t`.`existencia` AS `cantidad`,`t`.`epc` AS `epc`,`t`.`code` AS `code`,\\\'ts_existenciatarima\\\' AS `fuente` from (`ts_existenciatarima` `t` join `c_ubicacion` `u` on(`u`.`idy_ubica` = `t`.`idy_ubica`))',
  'v_inv_fisico_detalle' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_inv_fisico_detalle` AS select `t`.`ID_Inventario` AS `folio_inventario`,`t`.`NConteo` AS `NConteo`,`t`.`idy_ubica` AS `idy_ubica`,`t`.`ntarima` AS `ntarima`,`t`.`cve_articulo` AS `cve_articulo`,`t`.`Cve_Lote` AS `cve_lote`,\\\'TARIMA\\\' AS `tipo_unidad`,NULL AS `piezas_x_caja`,`t`.`existencia` AS `cantidad_conteo`,`t`.`Teorico` AS `existencia_teorica`,coalesce(`t`.`existencia`,0) - coalesce(`t`.`Teorico`,0) AS `diferencia`,`t`.`ID_Proveedor` AS `ID_Proveedor`,`t`.`Cuarentena` AS `Cuarentena`,`t`.`cve_usuario` AS `cve_usuario`,`t`.`fecha` AS `fecha` from `t_invtarima` `t` union all select `c`.`ID_Inventario` AS `folio_inventario`,`c`.`NConteo` AS `NConteo`,`c`.`idy_ubica` AS `idy_ubica`,NULL AS `ntarima`,`c`.`cve_articulo` AS `cve_articulo`,`c`.`cve_lote` AS `cve_lote`,\\\'CAJA\\\' AS `tipo_unidad`,`c`.`PiezasXCaja` AS `piezas_x_caja`,`c`.`Cantidad` AS `cantidad_conteo`,NULL AS `existencia_teorica`,NULL AS `diferencia`,NULL AS `ID_Proveedor`,NULL AS `Cuarentena`,`c`.`cve_usuario` AS `cve_usuario`,`c`.`fecha` AS `fecha` from `t_invcajas` `c` union all select `p`.`ID_Inventario` AS `folio_inventario`,`p`.`NConteo` AS `NConteo`,`p`.`idy_ubica` AS `idy_ubica`,NULL AS `ntarima`,`p`.`cve_articulo` AS `cve_articulo`,`p`.`cve_lote` AS `cve_lote`,\\\'PIEZA\\\' AS `tipo_unidad`,NULL AS `piezas_x_caja`,`p`.`Cantidad` AS `cantidad_conteo`,`p`.`ExistenciaTeorica` AS `existencia_teorica`,coalesce(`p`.`Cantidad`,0) - coalesce(`p`.`ExistenciaTeorica`,0) AS `diferencia`,`p`.`ID_Proveedor` AS `ID_Proveedor`,`p`.`Cuarentena` AS `Cuarentena`,`p`.`cve_usuario` AS `cve_usuario`,`p`.`fecha` AS `fecha` from `t_invpiezas` `p`',
  'v_inv_fisico_diferencias_det' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_inv_fisico_diferencias_det` AS select `p`.`ID_Inventario` AS `folio_inventario`,`p`.`NConteo` AS `NConteo`,`p`.`idy_ubica` AS `idy_ubica`,`p`.`cve_articulo` AS `cve_articulo`,`art`.`des_articulo` AS `des_articulo`,`p`.`cve_lote` AS `cve_lote`,`p`.`Cantidad` AS `cantidad_conteo`,`p`.`ExistenciaTeorica` AS `ExistenciaTeorica`,coalesce(`p`.`Cantidad`,0) - coalesce(`p`.`ExistenciaTeorica`,0) AS `diferencia_piezas`,coalesce(`art`.`costoPromedio`,`art`.`imp_costo`,0) AS `costo_unitario`,(coalesce(`p`.`Cantidad`,0) - coalesce(`p`.`ExistenciaTeorica`,0)) * coalesce(`art`.`costoPromedio`,`art`.`imp_costo`,0) AS `diferencia_valor`,`p`.`ID_Proveedor` AS `ID_Proveedor`,`p`.`Cuarentena` AS `Cuarentena`,`p`.`ClaveEtiqueta` AS `ClaveEtiqueta`,`p`.`cve_usuario` AS `cve_usuario`,`p`.`fecha` AS `fecha` from (`t_invpiezas` `p` left join `c_articulo` `art` on(`art`.`cve_articulo` = `p`.`cve_articulo`))',
  'v_inv_fisico_resumen' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_inv_fisico_resumen` AS select `a`.`consecutivo` AS `folio`,`a`.`almacen` AS `almacen`,`a`.`zona` AS `zona`,`a`.`fecha_inicio` AS `fecha_inicio`,`a`.`fecha_final` AS `fecha_final`,`a`.`usuario` AS `usuario`,`a`.`status` AS `status`,0 AS `ubicaciones`,0 AS `tarimas`,0 AS `cajas`,0 AS `piezas`,0 AS `diferencia_pzs`,0 AS `valor_inventario`,0 AS `diferencia_valor` from `v_administracioninventario` `a`',
  'v_inv_fisico_resumen_ao' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_inv_fisico_resumen_ao` AS select `a`.`consecutivo` AS `folio_inventario`,`a`.`almacen` AS `almacen`,`a`.`zona` AS `zona`,`a`.`fecha_inicio` AS `fecha_inicio`,`a`.`fecha_final` AS `fecha_final`,`a`.`usuario` AS `usuario`,`a`.`status` AS `status`,`a`.`diferencia` AS `diferencia_texto`,sum(coalesce(`p`.`Cantidad`,0)) AS `piezas_contadas`,sum(coalesce(`p`.`Cantidad`,0) - coalesce(`p`.`ExistenciaTeorica`,0)) AS `diferencia_piezas`,sum(coalesce(`p`.`Cantidad`,0) * coalesce(`art`.`costoPromedio`,`art`.`imp_costo`,0)) AS `valor_inventariado`,sum((coalesce(`p`.`Cantidad`,0) - coalesce(`p`.`ExistenciaTeorica`,0)) * coalesce(`art`.`costoPromedio`,`art`.`imp_costo`,0)) AS `valor_diferencia` from ((`v_administracioninventario` `a` left join `t_invpiezas` `p` on(`p`.`ID_Inventario` = `a`.`consecutivo`)) left join `c_articulo` `art` on(`art`.`cve_articulo` = `p`.`cve_articulo`)) group by `a`.`consecutivo`,`a`.`almacen`,`a`.`zona`,`a`.`fecha_inicio`,`a`.`fecha_final`,`a`.`usuario`,`a`.`status`,`a`.`diferencia` order by `a`.`fecha_inicio` desc',
  'v_kardex_bidireccional_v2' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_kardex_bidireccional_v2` AS select `tc`.`id` AS `tx_id`,`tc`.`fecha` AS `fecha_ts`,cast(`tc`.`fecha` as date) AS `fecha`,cast(`tc`.`fecha` as time) AS `hora`,`tm`.`nombre` AS `tipo_movimiento`,case when ucase(`tm`.`nombre`) like \\\'ENTRADA%\\\' then \\\'ENTRADA\\\' when ucase(`tm`.`nombre`) like \\\'SALIDA%\\\' then \\\'SALIDA\\\' when ucase(`tm`.`nombre`) like \\\'TRASPASO%\\\' or ucase(`tm`.`nombre`) like \\\'ACOMODO%\\\' then \\\'TRANSFERENCIA\\\' when ucase(`tm`.`nombre`) like \\\'AJUSTE%\\\' then \\\'AJUSTE\\\' else ucase(coalesce(`tm`.`nombre`,\\\'DESCONOCIDO\\\')) end AS `tipo_tx`,`tc`.`id_TipoMovimiento` AS `id_TipoMovimiento`,`tc`.`cve_articulo` AS `cve_articulo`,ifnull(`a`.`des_articulo`,\\\'\\\') AS `des_articulo`,nullif(`tc`.`cve_lote`,\\\'\\\') AS `lote`,`tc`.`Cve_Almac` AS `cve_almac`,ifnull(`ap`.`des_almac`,`tc`.`Cve_Almac`) AS `des_almac`,ifnull(`ap`.`zona`,\\\'\\\') AS `zona`,`tc`.`cve_usuario` AS `id_usuario`,ifnull(`u`.`nombre`,`tc`.`cve_usuario`) AS `operador`,`tc`.`stockinicial` AS `stockinicial`,`tc`.`cantidad` AS `cantidad`,`tc`.`ajuste` AS `ajuste`,case when ucase(`tm`.`nombre`) in (\\\'SALIDA\\\',\\\'BAJA\\\') then abs(coalesce(`tc`.`cantidad`,0)) when ucase(`tm`.`nombre`) like \\\'AJUSTE%\\\' and coalesce(`tc`.`cantidad`,0) < 0 then abs(`tc`.`cantidad`) when ucase(`tm`.`nombre`) in (\\\'TRANSFERENCIA\\\',\\\'ACOMODO\\\') then abs(coalesce(`tc`.`cantidad`,0)) else 0 end AS `mov_ori`,case when ucase(`tm`.`nombre`) = \\\'ENTRADA\\\' then abs(coalesce(`tc`.`cantidad`,0)) when ucase(`tm`.`nombre`) like \\\'AJUSTE%\\\' and coalesce(`tc`.`cantidad`,0) > 0 then `tc`.`cantidad` when ucase(`tm`.`nombre`) in (\\\'TRANSFERENCIA\\\',\\\'ACOMODO\\\') then abs(coalesce(`tc`.`cantidad`,0)) else 0 end AS `mov_dst`,case when ucase(`tm`.`nombre`) like \\\'ENTRADA%\\\' then 1 when ucase(`tm`.`nombre`) like \\\'SALIDA%\\\' then -1 when ucase(`tm`.`nombre`) like \\\'AJUSTE%\\\' then 0 when ucase(`tm`.`nombre`) like \\\'TRASPASO%\\\' then 0 else 0 end AS `signo`,`ap`.`empresa_id` AS `empresa_id`,`ap`.`clave_empresa` AS `empresa_clave`,`ap`.`empresa_nombre` AS `empresa_nombre`,`ap`.`empresa_rfc` AS `empresa_rfc`,cast(`lp`.`cve_proyecto` as char charset utf8mb4) AS `proyecto_lote`,cast(`lp`.`cve_proveedor` as char charset utf8mb4) AS `proveedor_lote`,cast(`pr2`.`des_proyecto` as char charset utf8mb4) AS `proyecto_lote_nombre`,cast(`pv`.`des_proveedor` as char charset utf8mb4) AS `proveedor_lote_nombre`,`tc`.`Referencia` AS `referencia`,`tc`.`origen` AS `origen`,`tc`.`destino` AS `destino`,`tc`.`Activo` AS `Activo`,`tc`.`Fec_Ingreso` AS `Fec_Ingreso`,`tc`.`Id_Motivo` AS `Id_Motivo` from (((((((`t_cardex` `tc` left join `t_tipomovimiento` `tm` on(cast(`tm`.`id_TipoMovimiento` as unsigned) = `tc`.`id_TipoMovimiento`)) left join `c_articulo` `a` on(md5(`a`.`cve_articulo`) = md5(`tc`.`cve_articulo`))) left join `v_almacen_compat` `ap` on(md5(`ap`.`clave`) = md5(`tc`.`Cve_Almac`))) left join `v_usuario_compat` `u` on(md5(`u`.`cve_usuario`) = md5(`tc`.`cve_usuario`))) left join `v_bi_lote_proyecto` `lp` on(cast(`lp`.`cve_articulo` as char charset utf8mb4) = cast(`tc`.`cve_articulo` as char charset utf8mb4) and cast(`lp`.`lote` as char charset utf8mb4) = cast(`tc`.`cve_lote` as char charset utf8mb4))) left join `v_bi_proyecto` `pr2` on(`pr2`.`cve_proyecto` = `lp`.`cve_proyecto`)) left join `v_bi_proveedor` `pv` on(`pv`.`cve_proveedor` = `lp`.`cve_proveedor`))',
  'v_kardex_doble_partida' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_kardex_doble_partida` AS select cast(`tc`.`id` as unsigned) AS `tx_id`,`tc`.`fecha` AS `fecha_hora`,case when ucase(`tm`.`nombre`) = \\\'ENTRADA\\\' then \\\'ENTRADA\\\' when ucase(`tm`.`nombre`) in (\\\'BAJA\\\',\\\'SALIDA\\\') then \\\'SALIDA\\\' when ucase(`tm`.`nombre`) in (\\\'ACOMODO\\\',\\\'TRANSFERENCIA\\\') then \\\'TRANSFERENCIA\\\' when ucase(`tm`.`nombre`) like \\\'AJUSTE%\\\' then \\\'AJUSTE\\\' else ucase(coalesce(`tm`.`nombre`,\\\'DESCONOCIDO\\\')) end AS `tipo_tx`,`tc`.`cve_articulo` AS `producto_id`,`art`.`des_articulo` AS `producto_nombre`,nullif(`tc`.`cve_lote`,\\\'\\\') AS `lote`,case when ucase(`tm`.`nombre`) in (\\\'SALIDA\\\',\\\'BAJA\\\') then abs(coalesce(`tc`.`cantidad`,0)) when ucase(`tm`.`nombre`) like \\\'AJUSTE%\\\' and coalesce(`tc`.`cantidad`,0) < 0 then abs(`tc`.`cantidad`) when ucase(`tm`.`nombre`) in (\\\'TRANSFERENCIA\\\',\\\'ACOMODO\\\') then abs(coalesce(`tc`.`cantidad`,0)) else 0 end AS `mov_ori`,case when ucase(`tm`.`nombre`) = \\\'ENTRADA\\\' then abs(coalesce(`tc`.`cantidad`,0)) when ucase(`tm`.`nombre`) like \\\'AJUSTE%\\\' and coalesce(`tc`.`cantidad`,0) > 0 then `tc`.`cantidad` when ucase(`tm`.`nombre`) in (\\\'TRANSFERENCIA\\\',\\\'ACOMODO\\\') then abs(coalesce(`tc`.`cantidad`,0)) else 0 end AS `mov_dst`,`tc`.`Cve_Almac` AS `alm_codigo`,`ca`.`des_almac` AS `zona_nombre`,`cap`.`nombre` AS `alm_nombre`,`cap`.`clave` AS `alm_clave`,coalesce(`cap`.`empresa_id`,`ca`.`empresa_id`,0) AS `empresa_id`,`cc`.`clave_empresa` AS `empresa_clave`,`cc`.`des_cia` AS `empresa_nombre`,`cc`.`des_rfc` AS `empresa_rfc`,`pr`.`Id` AS `proyecto_id`,`pr`.`Cve_Proyecto` AS `proyecto_clave`,`pr`.`Des_Proyecto` AS `proyecto_nombre`,`tc`.`Referencia` AS `Referencia`,`tc`.`cve_usuario` AS `cve_usuario`,`tc`.`origen` AS `origen`,`tc`.`destino` AS `destino`,`tc`.`stockinicial` AS `stockinicial`,`tc`.`ajuste` AS `ajuste`,`tc`.`id_TipoMovimiento` AS `id_TipoMovimiento`,`tc`.`Activo` AS `Activo`,`tc`.`Fec_Ingreso` AS `Fec_Ingreso`,`tc`.`Id_Motivo` AS `Id_Motivo` from ((((((`t_cardex` `tc` left join `t_tipomovimiento` `tm` on(`tm`.`id_TipoMovimiento` = `tc`.`id_TipoMovimiento`)) left join `c_almacen` `ca` on(convert(`ca`.`cve_almac` using utf8mb4) = convert(`tc`.`Cve_Almac` using utf8mb4))) left join `c_almacenp` `cap` on(convert(`cap`.`id` using utf8mb4) = convert(`tc`.`Cve_Almac` using utf8mb4) or convert(`cap`.`id` using utf8mb4) = convert(`ca`.`cve_almacenp` using utf8mb4))) left join `c_compania` `cc` on(`cc`.`empresa_id` = coalesce(`cap`.`empresa_id`,`ca`.`empresa_id`))) left join `c_articulo` `art` on(convert(`art`.`cve_articulo` using utf8mb4) = convert(`tc`.`cve_articulo` using utf8mb4) and `art`.`empresa_id` = coalesce(`cap`.`empresa_id`,`ca`.`empresa_id`))) left join `c_proyecto` `pr` on((convert(`pr`.`id_almacen` using utf8mb4) = convert(`cap`.`id` using utf8mb4) or convert(`pr`.`id_almacen` using utf8mb4) = convert(`ca`.`cve_almacenp` using utf8mb4) or convert(`pr`.`id_almacen` using utf8mb4) = convert(`tc`.`Cve_Almac` using utf8mb4)) and `pr`.`empresa_id` = coalesce(`cap`.`empresa_id`,`ca`.`empresa_id`)))',
  'v_kardex_enriquecido' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_kardex_enriquecido` AS select `k`.`id` AS `id`,`k`.`fecha` AS `fecha_ts`,cast(`k`.`fecha` as date) AS `fecha`,cast(`k`.`fecha` as time) AS `hora`,`tm`.`nombre` AS `tipo_mov_txt`,`k`.`cve_articulo` AS `cve_articulo`,ifnull(`a`.`des_articulo`,\\\'\\\') AS `desc_articulo`,`k`.`Cve_Almac` AS `cve_almac`,ifnull(`ap`.`des_almac`,`k`.`Cve_Almac`) AS `des_almac`,ifnull(`ap`.`zona`,\\\'\\\') AS `zona`,`k`.`cve_usuario` AS `id_usuario`,ifnull(`u`.`nombre`,`k`.`cve_usuario`) AS `operador`,`k`.`cantidad` AS `cantidad`,`k`.`cve_lote` AS `lote`,case when ucase(`tm`.`nombre`) like \\\'ENTRADA%\\\' then 1 when ucase(`tm`.`nombre`) like \\\'SALIDA%\\\' then -1 when ucase(`tm`.`nombre`) like \\\'AJUSTE%\\\' then 0 when ucase(`tm`.`nombre`) like \\\'TRASPASO%\\\' then 0 else 0 end AS `signo` from ((((`t_cardex` `k` left join `t_tipomovimiento` `tm` on(cast(`tm`.`id_TipoMovimiento` as unsigned) = `k`.`id_TipoMovimiento`)) left join `c_articulo` `a` on(md5(`a`.`cve_articulo`) = md5(`k`.`cve_articulo`))) left join `v_almacen_compat` `ap` on(md5(`ap`.`clave`) = md5(`k`.`Cve_Almac`))) left join `v_usuario_compat` `u` on(md5(`u`.`cve_usuario`) = md5(`k`.`cve_usuario`)))',
  'v_kardex_enriquecido_v2' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_kardex_enriquecido_v2` AS select `v`.`id` AS `id`,`v`.`fecha_ts` AS `fecha_ts`,`v`.`fecha` AS `fecha`,`v`.`hora` AS `hora`,`v`.`tipo_mov_txt` AS `tipo_mov_txt`,`v`.`cve_articulo` AS `cve_articulo`,`v`.`desc_articulo` AS `desc_articulo`,`v`.`cve_almac` AS `cve_almac`,`v`.`des_almac` AS `des_almac`,`v`.`zona` AS `zona`,`v`.`id_usuario` AS `id_usuario`,`v`.`operador` AS `operador`,`v`.`cantidad` AS `cantidad`,`v`.`lote` AS `lote`,`v`.`signo` AS `signo`,cast(`lp`.`cve_proyecto` as char charset utf8mb4) AS `cve_proyecto`,cast(`lp`.`cve_proveedor` as char charset utf8mb4) AS `cve_proveedor`,cast(`pr`.`des_proyecto` as char charset utf8mb4) AS `des_proyecto`,cast(`pv`.`des_proveedor` as char charset utf8mb4) AS `des_proveedor` from (((`v_kardex_enriquecido` `v` left join `v_bi_lote_proyecto` `lp` on(cast(`lp`.`cve_articulo` as char charset utf8mb4) = cast(`v`.`cve_articulo` as char charset utf8mb4) and cast(`lp`.`lote` as char charset utf8mb4) = cast(`v`.`lote` as char charset utf8mb4))) left join `v_bi_proyecto` `pr` on(`pr`.`cve_proyecto` = `lp`.`cve_proyecto`)) left join `v_bi_proveedor` `pv` on(`pv`.`cve_proveedor` = `lp`.`cve_proveedor`))',
  'v_kardex_enriquecido_v3' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_kardex_enriquecido_v3` AS select `vk`.`id` AS `id`,`vk`.`fecha_ts` AS `fecha_ts`,`vk`.`fecha` AS `fecha`,`vk`.`hora` AS `hora`,`vk`.`tipo_mov_txt` AS `tipo_mov_txt`,`vk`.`cve_articulo` AS `cve_articulo`,`vk`.`desc_articulo` AS `desc_articulo`,`vk`.`cve_almac` AS `cve_almac`,`vk`.`des_almac` AS `des_almac`,`vk`.`zona` AS `zona`,`vk`.`id_usuario` AS `id_usuario`,`vk`.`operador` AS `operador`,`vk`.`cantidad` AS `cantidad`,`vk`.`lote` AS `lote`,`vk`.`signo` AS `signo`,`vk`.`cve_proyecto` AS `cve_proyecto`,`vk`.`cve_proveedor` AS `cve_proveedor`,`vk`.`des_proyecto` AS `des_proyecto`,`vk`.`des_proveedor` AS `des_proveedor`,`p`.`Nombre` AS `ProveedorNombre`,`p`.`Empresa` AS `EmpresaProveedor`,case when `p`.`es_cliente` = 1 then \\\'SI\\\' else \\\'NO\\\' end AS `EsEmpresaProveedor` from (`v_kardex_enriquecido_v2` `vk` left join `c_proveedores` `p` on(`vk`.`cve_proveedor` collate utf8mb4_unicode_ci = `p`.`cve_proveedor` collate utf8mb4_unicode_ci))',
  'v_listap_detalle' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_listap_detalle` AS select `lp`.`id` AS `ListaId`,`lp`.`Lista` AS `NombreLista`,`lp`.`Tipo` AS `Tipo`,`lp`.`FechaIni` AS `FechaIni`,`lp`.`FechaFin` AS `FechaFin`,`lp`.`Cve_Almac` AS `Cve_Almac`,`lp`.`TipoServ` AS `TipoServ`,`lp`.`id_moneda` AS `id_moneda`,`d`.`id` AS `DetalleId`,`d`.`Cve_Articulo` AS `Cve_Articulo`,`d`.`PrecioMin` AS `PrecioMin`,`d`.`PrecioMax` AS `PrecioMax`,`d`.`Cve_Almac` AS `Cve_Almac_Det`,`d`.`ComisionPor` AS `ComisionPor`,`d`.`ComisionMon` AS `ComisionMon` from (`listap` `lp` join `detallelp` `d` on(`d`.`ListaId` = `lp`.`id`))',
  'v_log_operaciones' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_log_operaciones` AS select `t_log_operaciones`.`empresa_id` AS `empresa_id`,trim(`t_log_operaciones`.`modulo`) AS `modulo`,trim(`t_log_operaciones`.`usuario`) AS `usuario`,trim(`t_log_operaciones`.`operacion`) AS `operacion`,trim(`t_log_operaciones`.`dispositivo`) AS `dispositivo`,trim(`t_log_operaciones`.`observaciones`) AS `observaciones`,coalesce(str_to_date(trim(`t_log_operaciones`.`fecha`),\\\'%Y-%m-%d %H:%i:%s\\\'),str_to_date(trim(`t_log_operaciones`.`fecha`),\\\'%d/%m/%Y %H:%i:%s\\\'),str_to_date(trim(`t_log_operaciones`.`fecha`),\\\'%Y-%m-%d\\\'),str_to_date(trim(`t_log_operaciones`.`fecha`),\\\'%d/%m/%Y\\\')) AS `fecha_dt`,trim(`t_log_operaciones`.`fecha`) AS `fecha_raw` from `t_log_operaciones`',
  'v_lp_master' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_lp_master` AS select `ch`.`IDContenedor` AS `IDContenedor`,`ch`.`CveLP` AS `CveLP`,`ch`.`Clave_Contenedor` AS `Clave_Contenedor`,`ch`.`descripcion` AS `descripcion`,`ch`.`tipo` AS `tipo`,`ch`.`Permanente` AS `Permanente`,`ch`.`TipoGen` AS `TipoGen`,coalesce(`ex`.`existencia_total`,0) AS `existencia_total`,`u`.`CodigoCSD` AS `CodigoCSD`,`ca`.`des_almac` AS `zona_almacenaje`,`ap`.`id` AS `id_almacen`,`ap`.`clave` AS `clave_almacenp`,`ap`.`nombre` AS `nombre_almacen`,coalesce(`pc`.`total_contenedores`,0) AS `total_contenedores`,`pal`.`CveLP` AS `lp_pallet` from (((((((`c_charolas` `ch` left join (select `ts_existenciatarima`.`ntarima` AS `ntarima`,`ts_existenciatarima`.`cve_almac` AS `cve_almac`,sum(`ts_existenciatarima`.`existencia`) AS `existencia_total`,max(case when `ts_existenciatarima`.`existencia` > 0 then `ts_existenciatarima`.`idy_ubica` end) AS `idy_ubica` from `ts_existenciatarima` group by `ts_existenciatarima`.`ntarima`,`ts_existenciatarima`.`cve_almac`) `ex` on(`ex`.`ntarima` = `ch`.`IDContenedor`)) left join `c_ubicacion` `u` on(`u`.`idy_ubica` = `ex`.`idy_ubica`)) left join `c_almacen` `ca` on(`ca`.`cve_almac` = `u`.`cve_almac`)) left join `c_almacenp` `ap` on(`ap`.`id` = `ex`.`cve_almac`)) left join (select `ts_existenciacajas`.`nTarima` AS `nTarima`,count(distinct `ts_existenciacajas`.`Id_Caja`) AS `total_contenedores` from `ts_existenciacajas` group by `ts_existenciacajas`.`nTarima`) `pc` on(`pc`.`nTarima` = `ch`.`IDContenedor`)) left join (select `ts_existenciacajas`.`Id_Caja` AS `Id_caja`,max(`ts_existenciacajas`.`nTarima`) AS `nTarima_padre` from `ts_existenciacajas` group by `ts_existenciacajas`.`Id_Caja`) `cx` on(`cx`.`Id_caja` = `ch`.`IDContenedor`)) left join `c_charolas` `pal` on(`pal`.`IDContenedor` = `cx`.`nTarima_padre`))',
  'v_ocupacion_almacen_resumen' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_ocupacion_almacen_resumen` AS select `a`.`cve_almac` AS `cve_almac`,`a`.`des_almac` AS `des_almac`,count(`u`.`idy_ubica`) AS `total_ubicaciones`,sum(case when `te`.`idy_ubica` is not null then 1 else 0 end) AS `ubicaciones_utilizadas`,sum(case when `te`.`idy_ubica` is null then 1 else 0 end) AS `ubicaciones_libres`,round(sum(case when `te`.`idy_ubica` is not null then 1 else 0 end) / count(`u`.`idy_ubica`) * 100,2) AS `porcentaje_ocupacion` from ((`c_ubicacion` `u` join `c_almacen` `a` on(`a`.`cve_almac` = `u`.`cve_almac`)) left join `ts_existenciatarima` `te` on(`te`.`idy_ubica` = `u`.`idy_ubica` and `te`.`existencia` > 0 and `te`.`Activo` = 1)) where `u`.`Activo` = 1 group by `a`.`cve_almac`,`a`.`des_almac`',
  'v_ocupacion_almacen_tipos' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_ocupacion_almacen_tipos` AS select `a`.`cve_almac` AS `cve_almac`,`a`.`des_almac` AS `des_almac`,count(`u`.`idy_ubica`) AS `total_ubicaciones`,sum(`u`.`AcomodoMixto` = \\\'S\\\') AS `ubic_acomodo_mixto`,sum(`u`.`Reabasto` = \\\'S\\\') AS `ubic_reabasto`,sum(`u`.`picking` = \\\'S\\\') AS `ubic_picking`,sum(`u`.`AreaProduccion` = \\\'S\\\') AS `ubic_manufactura`,sum(`u`.`AreaStagging` = \\\'S\\\') AS `ubic_staging`,sum(`u`.`Ptl` = \\\'S\\\') AS `ubic_ptl`,sum(case when `te`.`idy_ubica` is not null then 1 else 0 end) AS `ubicaciones_utilizadas` from ((`c_ubicacion` `u` join `c_almacen` `a` on(`a`.`cve_almac` = `u`.`cve_almac`)) left join `ts_existenciatarima` `te` on(`te`.`idy_ubica` = `u`.`idy_ubica` and `te`.`existencia` > 0 and `te`.`Activo` = 1)) where `u`.`Activo` = 1 group by `a`.`cve_almac`,`a`.`des_almac`',
  'v_patio_tablero' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_patio_tablero` AS select `v`.`id_visita` AS `id_visita`,`v`.`id_transporte` AS `id_transporte`,`t`.`ID_Transporte` AS `id_transporte_cod`,`t`.`Nombre` AS `nombre_transporte`,`t`.`Placas` AS `placas`,`v`.`id_anden_actual` AS `id_anden_actual`,`v`.`estatus` AS `estatus_visita`,`v`.`fecha_llegada` AS `fecha_llegada`,`v`.`fecha_salida` AS `fecha_salida`,`c`.`id_cita` AS `id_cita`,`c`.`estatus` AS `estatus_cita`,case when `c`.`id_cita` is null then \\\'PENDIENTE\\\' when `c`.`estatus` in (\\\'PROGRAMADA\\\',\\\'CONFIRMADA\\\',\\\'EN_PROCESO\\\',\\\'CERRADA\\\') then \\\'OK\\\' when `c`.`estatus` in (\\\'CANCELADA\\\',\\\'NO_SHOW\\\') then \\\'ERROR\\\' else \\\'PENDIENTE\\\' end AS `etapa1_estado`,case when `v`.`fecha_llegada` is null then \\\'PENDIENTE\\\' when `v`.`estatus` in (\\\'EN_PATIO\\\',\\\'ASIGNADO_ANDEN\\\',\\\'EN_DESCARGA\\\',\\\'EN_CARGA\\\',\\\'ESPERA_SALIDA\\\',\\\'FINALIZADA\\\') then \\\'OK\\\' else \\\'PENDIENTE\\\' end AS `etapa2_estado`,(select case when count(0) = 0 then \\\'PENDIENTE\\\' when sum(case when `i`.`resultado_qa` = \\\'RECHAZADO\\\' then 1 else 0 end) > 0 then \\\'ERROR\\\' when sum(case when `i`.`usuario_autoriza` is null then 1 else 0 end) > 0 then \\\'REVISION\\\' else \\\'OK\\\' end from `t_patio_inspeccion` `i` where `i`.`id_visita` = `v`.`id_visita` and `i`.`tipo_inspeccion` = \\\'INGRESO\\\') AS `etapa3_estado`,(select case when count(0) = 0 then \\\'PENDIENTE\\\' when sum(case when `ca`.`estatus` = \\\'EN_PROCESO\\\' then 1 else 0 end) > 0 then \\\'EN_PROCESO\\\' when sum(case when `ca`.`estatus` = \\\'COMPLETADA\\\' then 1 else 0 end) > 0 then \\\'OK\\\' when sum(case when `ca`.`estatus` = \\\'CANCELADA\\\' then 1 else 0 end) > 0 then \\\'ERROR\\\' else \\\'PENDIENTE\\\' end from `t_patio_carga` `ca` where `ca`.`id_visita` = `v`.`id_visita`) AS `etapa4_estado` from ((`t_patio_visita` `v` left join `t_patio_cita` `c` on(`c`.`id_cita` = `v`.`id_cita`)) left join `t_transporte` `t` on(`t`.`id` = `v`.`id_transporte`))',
  'v_productividad_kardex_almacen' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_productividad_kardex_almacen` AS select `v`.`cve_almac` AS `cve_almac`,`v`.`des_almac` AS `des_almac`,count(0) AS `total_mov`,sum(case when ucase(`v`.`tipo_mov_txt`) like \\\'ENTRADA%\\\' then 1 else 0 end) AS `entradas`,sum(case when ucase(`v`.`tipo_mov_txt`) like \\\'SALIDA%\\\' then 1 else 0 end) AS `salidas`,sum(`v`.`signo` * `v`.`cantidad`) AS `balance_neto` from `v_kardex_enriquecido` `v` group by `v`.`cve_almac`,`v`.`des_almac` order by count(0) desc',
  'v_productividad_kardex_daily' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_productividad_kardex_daily` AS select `v`.`fecha` AS `fecha`,count(0) AS `total_mov`,sum(case when ucase(`v`.`tipo_mov_txt`) like \\\'ENTRADA%\\\' then 1 else 0 end) AS `entradas`,sum(case when ucase(`v`.`tipo_mov_txt`) like \\\'SALIDA%\\\' then 1 else 0 end) AS `salidas`,sum(`v`.`signo` * `v`.`cantidad`) AS `balance_neto` from `v_kardex_enriquecido` `v` group by `v`.`fecha` order by `v`.`fecha` desc',
  'v_productividad_kardex_topprod' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_productividad_kardex_topprod` AS select `v`.`cve_articulo` AS `cve_articulo`,`v`.`desc_articulo` AS `desc_articulo`,count(0) AS `movimientos`,sum(case when `v`.`signo` = 1 then `v`.`cantidad` else 0 end) AS `total_entrada`,sum(case when `v`.`signo` = -1 then `v`.`cantidad` else 0 end) AS `total_salida` from `v_kardex_enriquecido` `v` group by `v`.`cve_articulo`,`v`.`desc_articulo` order by count(0) desc',
  'v_productividad_kardex_usuario' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_productividad_kardex_usuario` AS select `v`.`id_usuario` AS `id_usuario`,`v`.`operador` AS `operador`,count(0) AS `total_mov`,sum(case when ucase(`v`.`tipo_mov_txt`) like \\\'ENTRADA%\\\' then 1 else 0 end) AS `entradas`,sum(case when ucase(`v`.`tipo_mov_txt`) like \\\'SALIDA%\\\' then 1 else 0 end) AS `salidas`,round(count(0) / nullif(count(distinct `v`.`fecha`),0),2) AS `prom_mov_por_dia` from `v_kardex_enriquecido` `v` group by `v`.`id_usuario`,`v`.`operador` order by count(0) desc',
  'v_rtm_admin' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_rtm_admin` AS select concat_ws(\\\'::\\\',`p`.`cve_articulo`,`p`.`Cve_Lote`,ifnull(`p`.`Cve_Ubicacion`,\\\'\\\'),ifnull(`p`.`ID_Proveedor`,\\\'\\\')) AS `id`,`p`.`cve_articulo` AS `cve_articulo`,`a`.`des_articulo` AS `des_articulo`,`p`.`Cve_Lote` AS `cve_lote`,`l`.`Caducidad` AS `caducidad`,`p`.`Cantidad` AS `CantPendiente`,`p`.`Cve_Ubicacion` AS `cve_ubicacion`,`p`.`ID_Proveedor` AS `ID_Proveedor`,`prov`.`cve_proveedor` AS `cve_proveedor`,`prov`.`Nombre` AS `proveedor` from (((`v_pendientesacomodo` `p` left join `c_articulo` `a` on(`a`.`cve_articulo` = `p`.`cve_articulo`)) left join `c_lotes` `l` on(`l`.`cve_articulo` = `p`.`cve_articulo` and `l`.`Lote` = `p`.`Cve_Lote`)) left join `c_proveedores` `prov` on(`prov`.`ID_Proveedor` = `p`.`ID_Proveedor`))',
  'v_rtm_entradas_det' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_rtm_entradas_det` AS select `h`.`empresa_id` AS `empresa_id`,`h`.`Fol_Folio` AS `folio_entrada`,`h`.`tipo` AS `tipo_entrada`,`h`.`id_ocompra` AS `numero_oc`,`h`.`Fol_OEP` AS `folio_erp`,`h`.`Fec_Entrada` AS `fecha_entrada`,`h`.`Cve_Almac` AS `cve_almacen`,`alm`.`nombre` AS `almacen`,`h`.`Cve_Proveedor` AS `cve_proveedor`,`h`.`Proveedor` AS `proveedor`,`h`.`ID_Protocolo` AS `ID_Protocolo`,`proto`.`descripcion` AS `protocolo`,`d`.`cve_articulo` AS `cve_articulo`,`art`.`des_articulo` AS `des_articulo`,`d`.`cve_lote` AS `cve_lote`,`lot`.`Caducidad` AS `caducidad`,`d`.`numero_serie` AS `numero_serie`,cast(`d`.`CantidadPedida` as decimal(18,4)) AS `CantidadPedida`,cast(`d`.`CantidadRecibida` as decimal(18,4)) AS `CantidadRecibida`,cast(`d`.`CantidadUbicada` as decimal(18,4)) AS `CantidadUbicada`,cast(`d`.`CantidadRecibida` as decimal(18,4)) - cast(`d`.`CantidadUbicada` as decimal(18,4)) AS `CantPendiente`,case when cast(`d`.`CantidadRecibida` as decimal(18,4)) > 0 then round(cast(`d`.`CantidadUbicada` as decimal(18,4)) / cast(`d`.`CantidadRecibida` as decimal(18,4)) * 100,2) else 0 end AS `pct_acomodado`,`ch`.`Clave_Contenedor` AS `Clave_Contenedor`,`ch`.`CveLP` AS `CveLP` from ((((((`th_entalmacen` `h` join `td_entalmacen` `d` on(`d`.`empresa_id` = `h`.`empresa_id` and `d`.`fol_folio` = `h`.`Fol_Folio`)) left join `c_articulo` `art` on(`art`.`cve_articulo` = `d`.`cve_articulo`)) left join `c_lotes` `lot` on(`lot`.`cve_articulo` = `d`.`cve_articulo` and `lot`.`Lote` = `d`.`cve_lote`)) left join `c_almacenp` `alm` on(`alm`.`clave` = `h`.`Cve_Almac`)) left join `t_protocolo` `proto` on(`proto`.`ID_Protocolo` = `h`.`ID_Protocolo`)) left join `c_charolas` `ch` on(`ch`.`Pedido` = `h`.`Fol_Folio`)) where cast(`d`.`CantidadRecibida` as decimal(18,4)) > cast(`d`.`CantidadUbicada` as decimal(18,4)) order by `h`.`Fec_Entrada`,`h`.`Fol_Folio`,`d`.`cve_articulo`,`d`.`cve_lote`',
  'v_secuencia_surtido_admin' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_secuencia_surtido_admin` AS select `s`.`id` AS `id`,`s`.`clave_sec` AS `clave_sec`,`s`.`nombre` AS `nombre`,`s`.`tipo_sec` AS `tipo_sec`,`s`.`proceso` AS `proceso`,`s`.`almacen_id` AS `almacen_id`,`ap`.`clave` AS `almacen_clave`,`ap`.`nombre` AS `almacen_nombre`,count(distinct `d`.`id`) AS `ubicaciones_asignadas`,coalesce(group_concat(distinct concat(`u`.`cve_usuario`,\\\' - \\\',`u`.`nombre_completo`) order by `u`.`nombre_completo` ASC separator \\\', \\\'),\\\'\\\') AS `usuarios_asignados` from ((((`c_secuencia_surtido` `s` join `c_almacenp` `ap` on(`ap`.`id` = `s`.`almacen_id`)) left join `c_secuencia_surtido_det` `d` on(`d`.`sec_id` = `s`.`id` and `d`.`activo` = 1)) left join `c_secuencia_surtido_usuario` `su` on(`su`.`sec_id` = `s`.`id` and `su`.`activo` = 1)) left join `c_usuario` `u` on(`u`.`id_user` = `su`.`usuario_id`)) where `s`.`activo` = 1 group by `s`.`id`,`s`.`clave_sec`,`s`.`nombre`,`s`.`tipo_sec`,`s`.`proceso`,`s`.`almacen_id`,`ap`.`clave`,`ap`.`nombre`',
  'v_secuencia_surtido_detalle' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_secuencia_surtido_detalle` AS select `d`.`id` AS `id`,`d`.`sec_id` AS `sec_id`,`s`.`nombre` AS `nombre_secuencia`,`d`.`orden` AS `orden`,`u`.`idy_ubica` AS `ubicacion_id`,`u`.`CodigoCSD` AS `bl`,`u`.`cve_pasillo` AS `pasillo`,`u`.`cve_rack` AS `rack`,`u`.`cve_nivel` AS `nivel`,`u`.`Seccion` AS `seccion`,`u`.`Ubicacion` AS `posicion` from ((`c_secuencia_surtido_det` `d` join `c_secuencia_surtido` `s` on(`s`.`id` = `d`.`sec_id`)) join `c_ubicacion` `u` on(`u`.`idy_ubica` = `d`.`ubicacion_id`)) where `d`.`activo` = 1 order by `s`.`id`,`d`.`orden`',
  'v_stg_bom_actual' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_stg_bom_actual` AS select `a`.`empresa_id` AS `empresa_id`,`a`.`Cve_Articulo` AS `Cve_Articulo`,`art`.`des_articulo` AS `DescripcionPadre`,`a`.`Cve_ArtComponente` AS `Cve_ArtComponente`,`comp`.`des_articulo` AS `DescripcionComponente`,`a`.`Cantidad` AS `Cantidad`,`a`.`cve_umed` AS `cve_umed`,`a`.`Etapa` AS `Etapa` from ((`stg_t_artcompuesto` `a` join `stg_c_articulo` `art` on(`a`.`Cve_Articulo` = `art`.`cve_articulo` and `a`.`empresa_id` = `art`.`empresa_id`)) join `stg_c_articulo` `comp` on(`a`.`Cve_ArtComponente` = `comp`.`cve_articulo` and `a`.`empresa_id` = `comp`.`empresa_id`))',
  'v_usuario_compat' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_usuario_compat` AS select cast(`c_usuario`.`id_user` as signed) AS `id_usuario`,coalesce(`c_usuario`.`nombre_completo`,`c_usuario`.`des_usuario`,`c_usuario`.`cve_usuario`) AS `nombre`,`c_usuario`.`cve_usuario` AS `cve_usuario`,`c_usuario`.`email` AS `email`,`c_usuario`.`perfil` AS `perfil`,`c_usuario`.`Activo` AS `Activo` from `c_usuario`',
);
        
        $maxRetries = 10;
        $attempt = 0;
        
        while (count($views) > 0 && $attempt < $maxRetries) {
            $attempt++;
            foreach ($views as $name => $sql) {
                try {
                    DB::statement("DROP VIEW IF EXISTS `$name`");
                    DB::statement($sql);
                    unset($views[$name]);
                } catch (\Throwable $e) {
                    // Ignore and retry
                }
            }
        }
        
        if (count($views) > 0) {
            throw new \Exception("Could not create views: " . implode(', ', array_keys($views)));
        }
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        $views = array_keys(array (
  'v_administracioninventario_ao' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_administracioninventario_ao` AS select `inv`.`ID_Inventario` AS `consecutivo`,date_format(coalesce(`det`.`f_ini`,`inv`.`Fecha`),\\\'%d-%m-%Y %H:%i:%s\\\') AS `fecha_inicio`,case when `inv`.`Status` in (\\\'T\\\',\\\'O\\\') then date_format(coalesce(`det`.`f_fin`,`inv`.`Fecha`),\\\'%d-%m-%Y %H:%i:%s\\\') when `inv`.`Status` = \\\'A\\\' then \\\'--\\\' else date_format(coalesce(`det`.`f_fin`,`inv`.`Fecha`),\\\'%d-%m-%Y %H:%i:%s\\\') end AS `fecha_final`,`ap`.`nombre` AS `almacen`,`ca`.`des_almac` AS `zona`,coalesce(`usu_det`.`nombre_completo`,`usu_cnt`.`nombre_completo`,\\\'--\\\') AS `usuario`,case when `inv`.`Status` in (\\\'T\\\',\\\'O\\\') then \\\'Cerrado\\\' when `inv`.`Status` = \\\'A\\\' then \\\'Abierto\\\' else `inv`.`Status` end AS `status`,`det`.`piezas_contadas` AS `piezas_contadas`,`det`.`piezas_teoricas` AS `piezas_teoricas`,coalesce(`det`.`piezas_contadas`,0) - coalesce(`det`.`piezas_teoricas`,0) AS `diferencia` from ((((((`th_inventario` `inv` left join `c_almacenp` `ap` on(`ap`.`clave` = `inv`.`cve_almacen`)) left join `c_almacen` `ca` on(`ca`.`cve_almac` = `inv`.`cve_zona`)) left join (select `p`.`ID_Inventario` AS `ID_Inventario`,min(`p`.`fecha`) AS `f_ini`,max(`p`.`fecha`) AS `f_fin`,substring_index(group_concat(`p`.`cve_usuario` order by `p`.`fecha` DESC separator \\\',\\\'),\\\',\\\',1) AS `last_user_det`,sum(coalesce(`p`.`Cantidad`,0)) AS `piezas_contadas`,sum(coalesce(`p`.`ExistenciaTeorica`,0)) AS `piezas_teoricas` from `t_invpiezas` `p` group by `p`.`ID_Inventario`) `det` on(`det`.`ID_Inventario` = `inv`.`ID_Inventario`)) left join (select `t`.`ID_Inventario` AS `ID_Inventario`,substring_index(group_concat(`t`.`cve_usuario` order by `t`.`NConteo` DESC separator \\\',\\\'),\\\',\\\',1) AS `last_user_cnt` from `t_conteoinventario` `t` group by `t`.`ID_Inventario`) `cnt` on(`cnt`.`ID_Inventario` = `inv`.`ID_Inventario`)) left join `c_usuario` `usu_det` on(`usu_det`.`cve_usuario` = `det`.`last_user_det`)) left join `c_usuario` `usu_cnt` on(`usu_cnt`.`cve_usuario` = `cnt`.`last_user_cnt`)) where `inv`.`Activo` = 1 group by `inv`.`ID_Inventario`,`inv`.`Fecha`,`inv`.`Status`,`ap`.`nombre`,`ca`.`des_almac`,`usu_det`.`nombre_completo`,`usu_cnt`.`nombre_completo`,`det`.`f_ini`,`det`.`f_fin`,`det`.`piezas_contadas`,`det`.`piezas_teoricas`',
  'v_almacen_compat' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_almacen_compat` AS select `cap`.`cve_cia` AS `empresa_id`,`cap`.`id` AS `id`,`cap`.`clave` AS `clave`,`cap`.`nombre` AS `des_almac`,coalesce(`cap`.`BL`,\\\'\\\') AS `zona` from `c_almacenp` `cap`',
  'v_bi_eficiencia_entrada' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_bi_eficiencia_entrada` AS select cast(coalesce(`h`.`Fec_Entrada`,`d`.`fecha_inicio`) as date) AS `fecha`,`h`.`Cve_Almac` AS `Cve_Almac`,cast(trim(`h`.`Proyecto`) as char charset utf8mb4) AS `cve_proyecto`,cast(trim(`h`.`Cve_Proveedor`) as char charset utf8mb4) AS `cve_proveedor`,`h`.`Cve_Usuario` AS `cve_usuario`,count(0) AS `movs`,sum(coalesce(`d`.`CantidadRecibida`,0)) AS `uds_movidas`,round(sum(greatest(timestampdiff(SECOND,coalesce(`d`.`fecha_inicio`,`h`.`HoraInicio`),coalesce(`d`.`fecha_fin`,`h`.`HoraFin`)),0)) / 3600,2) AS `horas_trab`,round(count(0) / nullif(sum(greatest(timestampdiff(SECOND,coalesce(`d`.`fecha_inicio`,`h`.`HoraInicio`),coalesce(`d`.`fecha_fin`,`h`.`HoraFin`)),0)) / 3600,0),2) AS `movs_por_hora`,round(sum(coalesce(`d`.`CantidadRecibida`,0)) / nullif(sum(greatest(timestampdiff(SECOND,coalesce(`d`.`fecha_inicio`,`h`.`HoraInicio`),coalesce(`d`.`fecha_fin`,`h`.`HoraFin`)),0)) / 3600,0),2) AS `uds_por_hora`,round(avg(greatest(timestampdiff(SECOND,coalesce(`d`.`fecha_inicio`,`h`.`HoraInicio`),coalesce(`d`.`fecha_fin`,`h`.`HoraFin`)),0)) / 60,1) AS `tmi_min_prom` from (`th_entalmacen` `h` left join `td_entalmacen` `d` on(`d`.`empresa_id` = `h`.`empresa_id` and trim(`d`.`fol_folio`) = trim(`h`.`Fol_Folio`))) group by cast(coalesce(`h`.`Fec_Entrada`,`d`.`fecha_inicio`) as date),`h`.`Cve_Almac`,cast(trim(`h`.`Proyecto`) as char charset utf8mb4),`h`.`Cve_Proveedor`,`h`.`Cve_Usuario`',
  'v_bi_lote_proyecto' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_bi_lote_proyecto` AS select cast(trim(`d`.`cve_articulo`) as char charset utf8mb4) AS `cve_articulo`,cast(trim(`d`.`cve_lote`) as char charset utf8mb4) AS `lote`,min(coalesce(`d`.`fecha_inicio`,`h`.`HoraInicio`,`h`.`Fec_Entrada`)) AS `ts_primera_entrada`,cast(trim(`h`.`Proyecto`) as char charset utf8mb4) AS `cve_proyecto`,cast(trim(`h`.`Cve_Proveedor`) as char charset utf8mb4) AS `cve_proveedor` from (`th_entalmacen` `h` join `td_entalmacen` `d` on(trim(`d`.`fol_folio`) = trim(`h`.`Fol_Folio`))) where coalesce(`d`.`cve_lote`,\\\'\\\') <> \\\'\\\' group by cast(trim(`d`.`cve_articulo`) as char charset utf8mb4),cast(trim(`d`.`cve_lote`) as char charset utf8mb4),cast(trim(`h`.`Proyecto`) as char charset utf8mb4),cast(trim(`h`.`Cve_Proveedor`) as char charset utf8mb4)',
  'v_bi_proveedor' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_bi_proveedor` AS select cast(`lp`.`cve_proveedor` as char charset utf8mb4) AS `cve_proveedor`,cast(`lp`.`cve_proveedor` as char charset utf8mb4) AS `des_proveedor` from `v_bi_lote_proyecto` `lp` where coalesce(`lp`.`cve_proveedor`,\\\'\\\') <> \\\'\\\' group by 1,2',
  'v_bi_proyecto' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_bi_proyecto` AS select cast(`p`.`Cve_Proyecto` as char charset utf8mb4) AS `cve_proyecto`,cast(`p`.`Des_Proyecto` as char charset utf8mb4) AS `des_proyecto` from `c_proyecto` `p` union select cast(`lp`.`cve_proyecto` as char charset utf8mb4) AS `Name_exp_1`,cast(`lp`.`cve_proyecto` as char charset utf8mb4) AS `Name_exp_2` from `v_bi_lote_proyecto` `lp` where coalesce(`lp`.`cve_proyecto`,\\\'\\\') <> \\\'\\\'',
  'v_cobranza_aging' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_cobranza_aging` AS select `c`.`IdEmpresa` AS `IdEmpresa`,`c`.`Cliente` AS `Cliente`,sum(coalesce(`c`.`Saldo`,0)) AS `TotalSaldo`,sum(case when `c`.`Saldo` > 0 and `c`.`FechaVence` is not null and to_days(curdate()) - to_days(`c`.`FechaVence`) <= 0 then `c`.`Saldo` else 0 end) AS `Bucket_0`,sum(case when `c`.`Saldo` > 0 and `c`.`FechaVence` is not null and to_days(curdate()) - to_days(`c`.`FechaVence`) between 1 and 30 then `c`.`Saldo` else 0 end) AS `Bucket_1_30`,sum(case when `c`.`Saldo` > 0 and `c`.`FechaVence` is not null and to_days(curdate()) - to_days(`c`.`FechaVence`) between 31 and 60 then `c`.`Saldo` else 0 end) AS `Bucket_31_60`,sum(case when `c`.`Saldo` > 0 and `c`.`FechaVence` is not null and to_days(curdate()) - to_days(`c`.`FechaVence`) between 61 and 90 then `c`.`Saldo` else 0 end) AS `Bucket_61_90`,sum(case when `c`.`Saldo` > 0 and `c`.`FechaVence` is not null and to_days(curdate()) - to_days(`c`.`FechaVence`) between 91 and 120 then `c`.`Saldo` else 0 end) AS `Bucket_91_120`,sum(case when `c`.`Saldo` > 0 and `c`.`FechaVence` is not null and to_days(curdate()) - to_days(`c`.`FechaVence`) > 120 then `c`.`Saldo` else 0 end) AS `Bucket_121_Mas` from `cobranza` `c` group by `c`.`IdEmpresa`,`c`.`Cliente`',
  'v_cobranza_analitico' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_cobranza_analitico` AS select `c`.`id` AS `id`,`c`.`IdEmpresa` AS `IdEmpresa`,`c`.`Cliente` AS `IdDestinatario`,`d`.`id_destinatario` AS `id_destinatario`,`d`.`Cve_Clte` AS `Cve_Clte`,`cli`.`id_cliente` AS `id_cliente`,`cli`.`RazonSocial` AS `RazonSocial`,`cli`.`RazonComercial` AS `RazonComercial`,`c`.`Documento` AS `Documento`,`c`.`TipoDoc` AS `TipoDoc`,`c`.`FolioInterno` AS `FolioInterno`,`c`.`Saldo` AS `Saldo`,`c`.`Status` AS `Status`,`c`.`RutaId` AS `RutaId`,`r`.`descripcion` AS `RutaDescripcion`,`c`.`UltPago` AS `UltPago`,`c`.`FechaReg` AS `FechaReg`,`c`.`FechaVence` AS `FechaVence`,`c`.`DiaO` AS `DiaO`,case when `c`.`FechaVence` is null then NULL else to_days(curdate()) - to_days(`c`.`FechaVence`) end AS `DiasAtraso`,case when `c`.`Saldo` is null then \\\'SIN_DATOS\\\' when `c`.`Saldo` <= 0 then \\\'PAGADO\\\' when `c`.`FechaVence` is null then \\\'SIN_VENCIMIENTO\\\' when `c`.`FechaVence` >= curdate() then \\\'VIGENTE\\\' else \\\'VENCIDO\\\' end AS `EstatusTexto`,case when `c`.`FechaVence` is null or `c`.`Saldo` <= 0 then \\\'SIN_RIESGO\\\' when to_days(curdate()) - to_days(`c`.`FechaVence`) <= 0 then \\\'0-0\\\' when to_days(curdate()) - to_days(`c`.`FechaVence`) between 1 and 30 then \\\'1-30\\\' when to_days(curdate()) - to_days(`c`.`FechaVence`) between 31 and 60 then \\\'31-60\\\' when to_days(curdate()) - to_days(`c`.`FechaVence`) between 61 and 90 then \\\'61-90\\\' when to_days(curdate()) - to_days(`c`.`FechaVence`) between 91 and 120 then \\\'91-120\\\' else \\\'121+\\\' end AS `RangoAntiguedad`,case when `c`.`FechaReg` is null then NULL else date_format(`c`.`FechaReg`,\\\'%Y-%m\\\') end AS `PeriodoMes` from (((`cobranza` `c` left join `c_destinatarios` `d` on(`d`.`id_destinatario` = `c`.`Cliente`)) left join `c_cliente` `cli` on(`cli`.`Cve_Clte` = `d`.`Cve_Clte`)) left join `t_ruta` `r` on(`r`.`ID_Ruta` = `c`.`RutaId`))',
  'v_cobranza_resumen_empresa' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_cobranza_resumen_empresa` AS select `c`.`IdEmpresa` AS `IdEmpresa`,count(0) AS `Documentos`,sum(coalesce(`c`.`Saldo`,0)) AS `TotalSaldo`,sum(case when `c`.`Saldo` > 0 and `c`.`FechaVence` is not null and `c`.`FechaVence` < curdate() then `c`.`Saldo` else 0 end) AS `CarteraVencida`,sum(case when `c`.`Saldo` > 0 and `c`.`FechaVence` is not null and `c`.`FechaVence` >= curdate() then `c`.`Saldo` else 0 end) AS `CarteraVigente` from `cobranza` `c` group by `c`.`IdEmpresa`',
  'v_crm_actividades_pendientes' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_crm_actividades_pendientes` AS select `a`.`id_act` AS `id_act`,`a`.`id_lead` AS `id_lead`,`a`.`id_opp` AS `id_opp`,`a`.`tipo` AS `tipo`,`a`.`descripcion` AS `descripcion`,`a`.`fecha_programada` AS `fecha_programada`,`a`.`fecha_realizada` AS `fecha_realizada`,`a`.`usuario` AS `usuario`,`a`.`estatus` AS `estatus`,`a`.`fecha_crea` AS `fecha_crea`,`l`.`nombre_contacto` AS `nombre_contacto`,`o`.`titulo` AS `oportunidad` from ((`t_crm_actividad` `a` left join `t_crm_lead` `l` on(`l`.`id_lead` = `a`.`id_lead`)) left join `t_crm_oportunidad` `o` on(`o`.`id_opp` = `a`.`id_opp`)) where `a`.`estatus` = \\\'Programada\\\' order by `a`.`fecha_programada`',
  'v_crm_conversion' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_crm_conversion` AS select sum(`t_crm_oportunidad`.`etapa` = \\\'Ganada\\\') AS `ganadas`,sum(`t_crm_oportunidad`.`etapa` = \\\'Perdida\\\') AS `perdidas`,sum(`t_crm_oportunidad`.`etapa` = \\\'Ganada\\\') / count(0) * 100 AS `conversion_pct` from `t_crm_oportunidad`',
  'v_crm_funnel' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_crm_funnel` AS select `t_crm_oportunidad`.`etapa` AS `etapa`,count(0) AS `total`,sum(`t_crm_oportunidad`.`valor_estimado` * (`t_crm_oportunidad`.`probabilidad` / 100)) AS `forecast` from `t_crm_oportunidad` where `t_crm_oportunidad`.`etapa` in (\\\'Prospecci贸n\\\',\\\'Propuesta\\\',\\\'Cotizado\\\',\\\'Negociaci贸n\\\') group by `t_crm_oportunidad`.`etapa`',
  'v_crm_ventas_plataforma' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_crm_ventas_plataforma` AS select `p`.`Fol_folio` AS `folio`,`p`.`Fec_Pedido` AS `fecha_pedido`,`f`.`id` AS `fuente_id`,`f`.`clave` AS `plataforma`,`f`.`descripcion` AS `plataforma_desc`,`p`.`fuente_detalle` AS `fuente_detalle`,`p`.`Cve_clte` AS `cve_cliente`,`cli`.`id_cliente` AS `cliente_id`,`cli`.`RazonSocial` AS `cliente`,`d`.`id` AS `pedido_det_id`,`d`.`Cve_articulo` AS `sku`,`d`.`cve_lote` AS `lote`,`d`.`Num_cantidad` AS `cantidad`,`d`.`Precio_unitario` AS `precio_unitario`,`d`.`Num_cantidad` * `d`.`Precio_unitario` AS `subtotal`,`d`.`Desc_Importe` AS `descuento`,`d`.`IVA` AS `iva_importe`,`d`.`Num_cantidad` * `d`.`Precio_unitario` - ifnull(`d`.`Desc_Importe`,0) + ifnull(`d`.`IVA`,0) AS `total_renglon`,`p`.`status` AS `estado_pedido` from (((`th_pedido` `p` join `td_pedido` `d` on(`d`.`Fol_folio` = `p`.`Fol_folio`)) left join `c_cliente` `cli` on(`cli`.`Cve_Clte` = `p`.`Cve_clte`)) left join `c_pedido_fuente` `f` on(`f`.`id` = `p`.`fuente_id`))',
  'v_dashboard_inv_ciclico_ao' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_dashboard_inv_ciclico_ao` AS select `p`.`ID_PLAN` AS `folio_plan`,`p`.`FECHA_INI` AS `fecha_inicio`,`p`.`FECHA_FIN` AS `fecha_fin`,`p`.`Activo` AS `Activo`,`ap`.`id` AS `id_almacen`,`ap`.`clave` AS `cve_almacen`,`ap`.`nombre` AS `des_almacen`,count(distinct `uinv`.`idy_ubica`) AS `ubicaciones_planeadas`,count(distinct `pz`.`idy_ubica`) AS `ubicaciones_contadas`,case when count(distinct `uinv`.`idy_ubica`) = 0 then 0 else round(count(distinct `pz`.`idy_ubica`) / count(distinct `uinv`.`idy_ubica`) * 100,2) end AS `avance_porcentual`,sum(coalesce(`pz`.`Cantidad`,0)) AS `piezas_contadas`,sum(coalesce(`pz`.`ExistenciaTeorica`,0)) AS `piezas_teoricas`,sum(coalesce(`pz`.`Cantidad`,0)) - sum(coalesce(`pz`.`ExistenciaTeorica`,0)) AS `diferencia_piezas`,case when `p`.`Activo` = 0 then \\\'Cerrado\\\' when count(distinct `pz`.`idy_ubica`) = 0 then \\\'Planeado\\\' when count(distinct `pz`.`idy_ubica`) < count(distinct `uinv`.`idy_ubica`) then \\\'En ejecuci贸n\\\' else \\\'Completado\\\' end AS `estado_proceso` from (((`cab_planifica_inventario` `p` join `c_almacenp` `ap` on(`ap`.`id` = `p`.`id_almacen`)) left join `ubicacionesinventareadas` `uinv` on(`uinv`.`ID_PLAN` = `p`.`ID_PLAN`)) left join `t_invpiezasciclico` `pz` on(`pz`.`ID_PLAN` = `p`.`ID_PLAN`)) group by `p`.`ID_PLAN`,`p`.`FECHA_INI`,`p`.`FECHA_FIN`,`p`.`Activo`,`ap`.`id`,`ap`.`clave`,`ap`.`nombre` order by `p`.`FECHA_INI` desc',
  'v_dashboard_inv_fisico_ao' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_dashboard_inv_fisico_ao` AS select `a`.`consecutivo` AS `folio_inventario`,`a`.`fecha_inicio` AS `fecha_creacion`,concat(\\\'INV \\\',`a`.`consecutivo`) AS `nombre_inventario`,`a`.`status` AS `status_inventario`,(select `c`.`cve_almac` from `c_almacen` `c` where ucase(trim(`c`.`des_almac`)) = ucase(trim(`a`.`almacen`)) limit 1) AS `cve_almacen`,`a`.`almacen` AS `almacen`,`a`.`zona` AS `cve_zona`,count(distinct `uai`.`idy_ubica`) AS `ubicaciones_planeadas`,count(distinct `ui`.`idy_ubica`) AS `ubicaciones_contadas`,case when count(distinct `uai`.`idy_ubica`) = 0 then 0 else round(count(distinct `ui`.`idy_ubica`) / count(distinct `uai`.`idy_ubica`) * 100,2) end AS `avance_porcentual`,sum(coalesce(`p`.`Cantidad`,0)) AS `piezas_contadas`,sum(coalesce(`p`.`ExistenciaTeorica`,0)) AS `piezas_teoricas`,sum(coalesce(`p`.`Cantidad`,0)) - sum(coalesce(`p`.`ExistenciaTeorica`,0)) AS `diferencia_piezas`,case when `a`.`status` = \\\'Cerrado\\\' then \\\'Cerrado\\\' when count(distinct `ui`.`idy_ubica`) = 0 then \\\'Planeado\\\' when count(distinct `ui`.`idy_ubica`) < count(distinct `uai`.`idy_ubica`) then \\\'En ejecuci贸n\\\' else \\\'Completado\\\' end AS `estado_proceso` from (((`v_administracioninventario_ao` `a` left join `t_ubicacionesainventariar` `uai` on(`uai`.`ID_Inventario` = `a`.`consecutivo`)) left join `t_ubicacioninventario` `ui` on(`ui`.`ID_Inventario` = `a`.`consecutivo`)) left join `t_invpiezas` `p` on(`p`.`ID_Inventario` = `a`.`consecutivo`)) group by `a`.`consecutivo`,`a`.`fecha_inicio`,`a`.`status`,`a`.`almacen`,`a`.`zona` order by `a`.`fecha_inicio` desc',
  'v_dashboard_inv_fisico_fast_ao' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_dashboard_inv_fisico_fast_ao` AS select `inv`.`ID_Inventario` AS `folio_inventario`,`inv`.`Fecha` AS `fecha_creacion`,`ap`.`nombre` AS `almacen`,`ca`.`des_almac` AS `zona`,case when `inv`.`Status` in (\\\'T\\\',\\\'O\\\') then \\\'Cerrado\\\' when `inv`.`Status` = \\\'A\\\' then \\\'Abierto\\\' else `inv`.`Status` end AS `status_inventario`,coalesce(`uai`.`ubic_plan`,0) AS `ubicaciones_planeadas`,coalesce(`ui`.`ubic_cont`,0) AS `ubicaciones_contadas`,case when coalesce(`uai`.`ubic_plan`,0) = 0 then 0 else round(coalesce(`ui`.`ubic_cont`,0) * 100.0 / `uai`.`ubic_plan`,2) end AS `avance_porcentual`,coalesce(`det`.`piezas_contadas`,0) AS `piezas_contadas`,coalesce(`det`.`piezas_teoricas`,0) AS `piezas_teoricas`,coalesce(`det`.`piezas_contadas`,0) - coalesce(`det`.`piezas_teoricas`,0) AS `diferencia_piezas` from (((((`th_inventario` `inv` left join `c_almacenp` `ap` on(`ap`.`clave` = `inv`.`cve_almacen`)) left join `c_almacen` `ca` on(`ca`.`cve_almac` = `inv`.`cve_zona`)) left join (select `t_invpiezas`.`ID_Inventario` AS `ID_Inventario`,sum(coalesce(`t_invpiezas`.`Cantidad`,0)) AS `piezas_contadas`,sum(coalesce(`t_invpiezas`.`ExistenciaTeorica`,0)) AS `piezas_teoricas` from `t_invpiezas` group by `t_invpiezas`.`ID_Inventario`) `det` on(`det`.`ID_Inventario` = `inv`.`ID_Inventario`)) left join (select `t_ubicacionesainventariar`.`ID_Inventario` AS `ID_Inventario`,count(distinct `t_ubicacionesainventariar`.`idy_ubica`) AS `ubic_plan` from `t_ubicacionesainventariar` group by `t_ubicacionesainventariar`.`ID_Inventario`) `uai` on(`uai`.`ID_Inventario` = `inv`.`ID_Inventario`)) left join (select `t_ubicacioninventario`.`ID_Inventario` AS `ID_Inventario`,count(distinct `t_ubicacioninventario`.`idy_ubica`) AS `ubic_cont` from `t_ubicacioninventario` group by `t_ubicacioninventario`.`ID_Inventario`) `ui` on(`ui`.`ID_Inventario` = `inv`.`ID_Inventario`)) where `inv`.`Activo` = 1',
  'v_dispositivos' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_dispositivos` AS select `d`.`id` AS `id`,`d`.`id_almacen` AS `id_almacen`,`a`.`clave` AS `almacen_clave`,`a`.`nombre` AS `almacen_nombre`,`d`.`tipo` AS `tipo`,`d`.`marca` AS `marca`,`d`.`modelo` AS `modelo`,`d`.`serie` AS `serie`,`d`.`imei` AS `imei`,`d`.`mac_wifi` AS `mac_wifi`,`d`.`mac_bt` AS `mac_bt`,`d`.`ip` AS `ip`,`d`.`usuario_asignado` AS `usuario_asignado`,`d`.`estatus` AS `estatus`,`d`.`fecha_alta` AS `fecha_alta` from (`s_dispositivos` `d` left join `c_almacenp` `a` on(`a`.`id` = `d`.`id_almacen`))',
  'v_ecommerce_articulos' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_ecommerce_articulos` AS select `a`.`id` AS `id`,`a`.`cve_articulo` AS `cve_articulo`,`a`.`des_articulo` AS `des_articulo`,`lp`.`id` AS `ListaId`,`lp`.`Lista` AS `NombreLista`,`dp`.`PrecioMin` AS `PrecioLista`,`a`.`ecommerce_categoria` AS `ecommerce_categoria`,`a`.`ecommerce_subcategoria` AS `ecommerce_subcategoria`,`a`.`ecommerce_img_principal` AS `ecommerce_img_principal`,`a`.`ecommerce_img_galeria` AS `ecommerce_img_galeria`,`a`.`ecommerce_tags` AS `ecommerce_tags`,`a`.`ecommerce_destacado` AS `ecommerce_destacado` from ((`c_articulo` `a` left join `detallelp` `dp` on(`dp`.`Cve_Articulo` = `a`.`cve_articulo`)) left join `listap` `lp` on(`lp`.`id` = `dp`.`ListaId`)) where ifnull(`a`.`ecommerce_activo`,0) = 1',
  'v_ecommerce_precios' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_ecommerce_precios` AS select `d`.`Cve_Articulo` AS `Cve_Articulo`,`d`.`PrecioMin` AS `PrecioMin`,`d`.`PrecioMax` AS `PrecioMax`,`d`.`ListaId` AS `ListaId`,`lp`.`Lista` AS `Lista`,`lp`.`FechaIni` AS `FechaIni`,`lp`.`FechaFin` AS `FechaFin`,`lp`.`Cve_Almac` AS `Cve_Almac`,`lp`.`id_moneda` AS `id_moneda` from (`detallelp` `d` join `listap` `lp` on(`lp`.`id` = `d`.`ListaId`)) where `lp`.`Lista` = \\\'e-commerce\\\' and (`lp`.`FechaIni` is null or `lp`.`FechaIni` = \\\'0000-00-00\\\' or `lp`.`FechaIni` <= curdate()) and (`lp`.`FechaFin` is null or `lp`.`FechaFin` = \\\'0000-00-00\\\' or `lp`.`FechaFin` >= curdate())',
  'v_existencias_por_ubicacion_ao' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_existencias_por_ubicacion_ao` AS select --------------------------------------------------------------------------------------------------------------------------------`e`.`cve_almac` AS `cve_almac`,`u`.`idy_ubica` AS `idy_ubica`,`u`.`CodigoCSD` AS `bl`,`u`.`cve_pasillo` AS `pasillo`,`u`.`cve_rack` AS `rack`,`u`.`cve_nivel` AS `nivel`,`u`.`Status` AS `status_ubicacion`,`u`.`picking` AS `es_picking`,`e`.`cve_articulo` AS `cve_articulo`,`art`.`des_articulo` AS `des_articulo`,`art`.`control_lotes` AS `control_lotes`,`art`.`control_numero_series` AS `control_numero_series`,`art`.`Caduca` AS `Caduca`,case when `art`.`control_numero_series` = \\\'S\\\' then \\\'SERIE\\\' when `art`.`control_lotes` = \\\'S\\\' then \\\'LOTE\\\' else \\\'SIN_CONTROL\\\' end AS `tipo_control`,`e`.`cve_lote` AS `cve_lote`,`l`.`Caducidad` AS `Caducidad`,`e`.`Lote_Alterno` AS `Lote_Alterno`,`e`.`Existencia` AS `existencia`,`e`.`Cuarentena` AS `es_qa`,case when `e`.`Cuarentena` = 1 then 0 else `e`.`Existencia` end AS `disponible`,case when `e`.`Existencia` = 0 then \\\'LIBRE\\\' else \\\'OCUPADO\\\' end AS `estado_bl`,`e`.`Cve_Contenedor` AS `Cve_Contenedor`,`ch`.`CveLP` AS `CveLP`,--------------------------------------------------------------------------------------------------------------------------------`a`.`cve_almac` AS `id_almacen`,`a`.`clave_almacen` AS `clave_almacen`,`a`.`des_almac` AS `des_almac`,`a`.`Cve_TipoZona` AS `zona_almacen`,--------------------------------------------------------------------------------------------------------------------------------cast(`ap`.`cve_cia` as signed) AS `empresa_id`,`cia`.`des_cia` AS `empresa_nombre`,`cia`.`clave_empresa` AS `empresa_clave`,`cia`.`des_rfc` AS `empresa_rfc`,`cia`.`distrito` AS `empresa_distrito`,--------------------------------------------------------------------------------------------------------------------------------`u`.`Seccion` AS `seccion`,`u`.`Ubicacion` AS `posicion`,`u`.`orden_secuencia` AS `orden_secuencia`,`u`.`PesoMaximo` AS `peso_maximo`,`u`.`PesoOcupado` AS `peso_ocupado`,`u`.`TECNOLOGIA` AS `tecnologia`,`u`.`Maneja_Cajas` AS `maneja_cajas`,`u`.`Maneja_Piezas` AS `maneja_piezas`,`u`.`Reabasto` AS `reabasto`,`u`.`Tipo` AS `tipo_ubicacion`,`u`.`AcomodoMixto` AS `acomodo_mixto`,`u`.`AreaProduccion` AS `area_produccion`,`u`.`AreaStagging` AS `area_stagging`,`u`.`Ptl` AS `ptl`,`u`.`Maximo` AS `maximo`,`u`.`Minimo` AS `minimo`,`u`.`clasif_abc` AS `clasif_abc` from (((((((`mv_existencia_gral` `e` join `c_ubicacion` `u` on(`u`.`idy_ubica` = `e`.`cve_ubicacion`)) join `c_articulo` `art` on(`art`.`cve_articulo` = `e`.`cve_articulo` and `art`.`cve_almac` = `e`.`cve_almac`)) left join `c_lotes` `l` on(`l`.`cve_articulo` = `e`.`cve_articulo` and `l`.`Lote` = `e`.`cve_lote`)) left join `c_charolas` `ch` on(`ch`.`cve_almac` = `e`.`cve_almac` and `ch`.`Clave_Contenedor` = `e`.`Cve_Contenedor`)) left join `c_almacen` `a` on(`a`.`cve_almac` = `e`.`cve_almac`)) left join `c_almacenp` `ap` on(`ap`.`id` = `a`.`cve_almacenp`)) left join `c_compania` `cia` on(`cia`.`cve_cia` = cast(`ap`.`cve_cia` as signed)))',
  'v_impresoras' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_impresoras` AS select `i`.`id` AS `id`,`i`.`id_almacen` AS `id_almacen`,`a`.`clave` AS `almacen_clave`,`a`.`nombre` AS `almacen_nombre`,`i`.`IP` AS `IP`,`i`.`TIPO_IMPRESORA` AS `TIPO_IMPRESORA`,`i`.`NOMBRE` AS `NOMBRE`,`i`.`Marca` AS `Marca`,`i`.`Modelo` AS `Modelo`,`i`.`Densidad_Imp` AS `Densidad_Imp`,`i`.`TIPO_CONEXION` AS `TIPO_CONEXION`,`i`.`PUERTO` AS `PUERTO`,`i`.`TiempoEspera` AS `TiempoEspera`,`i`.`Activo` AS `Activo` from (`s_impresoras` `i` left join `c_almacenp` `a` on(`a`.`id` = `i`.`id_almacen`))',
  'v_inv_ciclico_detalle_ao' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_inv_ciclico_detalle_ao` AS select `t`.`ID_PLAN` AS `folio_plan`,`t`.`NConteo` AS `NConteo`,`t`.`idy_ubica` AS `idy_ubica`,`t`.`cve_articulo` AS `cve_articulo`,`t`.`cve_lote` AS `cve_lote`,\\\'PIEZA\\\' AS `tipo_unidad`,NULL AS `piezas_x_caja`,`t`.`Cantidad` AS `cantidad_conteo`,`t`.`ExistenciaTeorica` AS `existencia_teorica`,coalesce(`t`.`Cantidad`,0) - coalesce(`t`.`ExistenciaTeorica`,0) AS `diferencia_piezas`,`t`.`Id_Proveedor` AS `Id_Proveedor`,`t`.`Cuarentena` AS `Cuarentena`,`t`.`ClaveEtiqueta` AS `ClaveEtiqueta`,`t`.`cve_usuario` AS `cve_usuario`,`t`.`fecha` AS `fecha` from `t_invpiezasciclico` `t`',
  'v_inv_ciclico_diferencias_det' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_inv_ciclico_diferencias_det` AS select `t`.`ID_PLAN` AS `folio_plan`,`t`.`NConteo` AS `NConteo`,`t`.`idy_ubica` AS `idy_ubica`,`t`.`cve_articulo` AS `cve_articulo`,`art`.`des_articulo` AS `des_articulo`,`t`.`cve_lote` AS `cve_lote`,`t`.`Cantidad` AS `cantidad_conteo`,`t`.`ExistenciaTeorica` AS `ExistenciaTeorica`,coalesce(`t`.`Cantidad`,0) - coalesce(`t`.`ExistenciaTeorica`,0) AS `diferencia_piezas`,coalesce(`art`.`costoPromedio`,`art`.`imp_costo`,0) AS `costo_unitario`,(coalesce(`t`.`Cantidad`,0) - coalesce(`t`.`ExistenciaTeorica`,0)) * coalesce(`art`.`costoPromedio`,`art`.`imp_costo`,0) AS `diferencia_valor`,`t`.`Id_Proveedor` AS `Id_Proveedor`,`t`.`Cuarentena` AS `Cuarentena`,`t`.`ClaveEtiqueta` AS `ClaveEtiqueta`,`t`.`cve_usuario` AS `cve_usuario`,`t`.`fecha` AS `fecha` from (`t_invpiezasciclico` `t` left join `c_articulo` `art` on(`art`.`cve_articulo` = `t`.`cve_articulo`))',
  'v_inv_conteos_multinivel' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_inv_conteos_multinivel` AS select \\\'PZ\\\' AS `nivel`,`p`.`ID_Inventario` AS `ID_Inventario`,`p`.`NConteo` AS `NConteo`,`p`.`idy_ubica` AS `idy_ubica`,`u`.`CodigoCSD` AS `bl`,`p`.`cve_articulo` AS `cve_articulo`,`p`.`cve_lote` AS `cve_lote`,NULL AS `Id_Caja`,NULL AS `nTarima`,`p`.`Cantidad` AS `cantidad`,`p`.`cve_usuario` AS `cve_usuario`,`p`.`fecha` AS `fecha`,\\\'t_invpiezas\\\' AS `fuente` from (`t_invpiezas` `p` join `c_ubicacion` `u` on(`u`.`idy_ubica` = `p`.`idy_ubica`)) union all select \\\'CT\\\' AS `nivel`,`c`.`ID_Inventario` AS `ID_Inventario`,`c`.`NConteo` AS `NConteo`,`c`.`idy_ubica` AS `idy_ubica`,`u`.`CodigoCSD` AS `bl`,`c`.`cve_articulo` AS `cve_articulo`,`c`.`cve_lote` AS `cve_lote`,`c`.`Id_Caja` AS `Id_Caja`,`c`.`nTarima` AS `nTarima`,`c`.`Cantidad` AS `cantidad`,`c`.`cve_usuario` AS `cve_usuario`,`c`.`fecha` AS `fecha`,\\\'t_invcajas\\\' AS `fuente` from (`t_invcajas` `c` join `c_ubicacion` `u` on(`u`.`idy_ubica` = `c`.`idy_ubica`)) union all select \\\'LP\\\' AS `nivel`,`t`.`ID_Inventario` AS `ID_Inventario`,`t`.`NConteo` AS `NConteo`,`t`.`idy_ubica` AS `idy_ubica`,`u`.`CodigoCSD` AS `bl`,`t`.`cve_articulo` AS `cve_articulo`,`t`.`Cve_Lote` AS `cve_lote`,NULL AS `Id_Caja`,`t`.`ntarima` AS `nTarima`,`t`.`existencia` AS `cantidad`,`t`.`cve_usuario` AS `cve_usuario`,`t`.`fecha` AS `fecha`,\\\'t_invtarima\\\' AS `fuente` from (`t_invtarima` `t` join `c_ubicacion` `u` on(`u`.`idy_ubica` = `t`.`idy_ubica`))',
  'v_inv_existencia_multinivel' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_inv_existencia_multinivel` AS select \\\'PZ\\\' AS `nivel`,`p`.`cve_almac` AS `cve_almac`,`p`.`idy_ubica` AS `idy_ubica`,`u`.`CodigoCSD` AS `bl`,`p`.`cve_articulo` AS `cve_articulo`,`p`.`cve_lote` AS `cve_lote`,NULL AS `Id_Caja`,NULL AS `nTarima`,`p`.`Existencia` AS `cantidad`,`p`.`epc` AS `epc`,`p`.`code` AS `code`,\\\'ts_existenciapiezas\\\' AS `fuente` from (`ts_existenciapiezas` `p` join `c_ubicacion` `u` on(`u`.`idy_ubica` = `p`.`idy_ubica`)) union all select \\\'CT\\\' AS `nivel`,`c`.`Cve_Almac` AS `cve_almac`,`c`.`idy_ubica` AS `idy_ubica`,`u`.`CodigoCSD` AS `bl`,`c`.`cve_articulo` AS `cve_articulo`,`c`.`cve_lote` AS `cve_lote`,`c`.`Id_Caja` AS `Id_Caja`,`c`.`nTarima` AS `nTarima`,`c`.`PiezasXCaja` AS `cantidad`,`c`.`epc` AS `epc`,`c`.`code` AS `code`,\\\'ts_existenciacajas\\\' AS `fuente` from (`ts_existenciacajas` `c` join `c_ubicacion` `u` on(`u`.`idy_ubica` = `c`.`idy_ubica`)) union all select \\\'LP\\\' AS `nivel`,`t`.`cve_almac` AS `cve_almac`,`t`.`idy_ubica` AS `idy_ubica`,`u`.`CodigoCSD` AS `bl`,`t`.`cve_articulo` AS `cve_articulo`,`t`.`lote` AS `cve_lote`,NULL AS `Id_Caja`,`t`.`ntarima` AS `nTarima`,`t`.`existencia` AS `cantidad`,`t`.`epc` AS `epc`,`t`.`code` AS `code`,\\\'ts_existenciatarima\\\' AS `fuente` from (`ts_existenciatarima` `t` join `c_ubicacion` `u` on(`u`.`idy_ubica` = `t`.`idy_ubica`))',
  'v_inv_fisico_detalle' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_inv_fisico_detalle` AS select `t`.`ID_Inventario` AS `folio_inventario`,`t`.`NConteo` AS `NConteo`,`t`.`idy_ubica` AS `idy_ubica`,`t`.`ntarima` AS `ntarima`,`t`.`cve_articulo` AS `cve_articulo`,`t`.`Cve_Lote` AS `cve_lote`,\\\'TARIMA\\\' AS `tipo_unidad`,NULL AS `piezas_x_caja`,`t`.`existencia` AS `cantidad_conteo`,`t`.`Teorico` AS `existencia_teorica`,coalesce(`t`.`existencia`,0) - coalesce(`t`.`Teorico`,0) AS `diferencia`,`t`.`ID_Proveedor` AS `ID_Proveedor`,`t`.`Cuarentena` AS `Cuarentena`,`t`.`cve_usuario` AS `cve_usuario`,`t`.`fecha` AS `fecha` from `t_invtarima` `t` union all select `c`.`ID_Inventario` AS `folio_inventario`,`c`.`NConteo` AS `NConteo`,`c`.`idy_ubica` AS `idy_ubica`,NULL AS `ntarima`,`c`.`cve_articulo` AS `cve_articulo`,`c`.`cve_lote` AS `cve_lote`,\\\'CAJA\\\' AS `tipo_unidad`,`c`.`PiezasXCaja` AS `piezas_x_caja`,`c`.`Cantidad` AS `cantidad_conteo`,NULL AS `existencia_teorica`,NULL AS `diferencia`,NULL AS `ID_Proveedor`,NULL AS `Cuarentena`,`c`.`cve_usuario` AS `cve_usuario`,`c`.`fecha` AS `fecha` from `t_invcajas` `c` union all select `p`.`ID_Inventario` AS `folio_inventario`,`p`.`NConteo` AS `NConteo`,`p`.`idy_ubica` AS `idy_ubica`,NULL AS `ntarima`,`p`.`cve_articulo` AS `cve_articulo`,`p`.`cve_lote` AS `cve_lote`,\\\'PIEZA\\\' AS `tipo_unidad`,NULL AS `piezas_x_caja`,`p`.`Cantidad` AS `cantidad_conteo`,`p`.`ExistenciaTeorica` AS `existencia_teorica`,coalesce(`p`.`Cantidad`,0) - coalesce(`p`.`ExistenciaTeorica`,0) AS `diferencia`,`p`.`ID_Proveedor` AS `ID_Proveedor`,`p`.`Cuarentena` AS `Cuarentena`,`p`.`cve_usuario` AS `cve_usuario`,`p`.`fecha` AS `fecha` from `t_invpiezas` `p`',
  'v_inv_fisico_diferencias_det' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_inv_fisico_diferencias_det` AS select `p`.`ID_Inventario` AS `folio_inventario`,`p`.`NConteo` AS `NConteo`,`p`.`idy_ubica` AS `idy_ubica`,`p`.`cve_articulo` AS `cve_articulo`,`art`.`des_articulo` AS `des_articulo`,`p`.`cve_lote` AS `cve_lote`,`p`.`Cantidad` AS `cantidad_conteo`,`p`.`ExistenciaTeorica` AS `ExistenciaTeorica`,coalesce(`p`.`Cantidad`,0) - coalesce(`p`.`ExistenciaTeorica`,0) AS `diferencia_piezas`,coalesce(`art`.`costoPromedio`,`art`.`imp_costo`,0) AS `costo_unitario`,(coalesce(`p`.`Cantidad`,0) - coalesce(`p`.`ExistenciaTeorica`,0)) * coalesce(`art`.`costoPromedio`,`art`.`imp_costo`,0) AS `diferencia_valor`,`p`.`ID_Proveedor` AS `ID_Proveedor`,`p`.`Cuarentena` AS `Cuarentena`,`p`.`ClaveEtiqueta` AS `ClaveEtiqueta`,`p`.`cve_usuario` AS `cve_usuario`,`p`.`fecha` AS `fecha` from (`t_invpiezas` `p` left join `c_articulo` `art` on(`art`.`cve_articulo` = `p`.`cve_articulo`))',
  'v_inv_fisico_resumen' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_inv_fisico_resumen` AS select `a`.`consecutivo` AS `folio`,`a`.`almacen` AS `almacen`,`a`.`zona` AS `zona`,`a`.`fecha_inicio` AS `fecha_inicio`,`a`.`fecha_final` AS `fecha_final`,`a`.`usuario` AS `usuario`,`a`.`status` AS `status`,0 AS `ubicaciones`,0 AS `tarimas`,0 AS `cajas`,0 AS `piezas`,0 AS `diferencia_pzs`,0 AS `valor_inventario`,0 AS `diferencia_valor` from `v_administracioninventario` `a`',
  'v_inv_fisico_resumen_ao' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_inv_fisico_resumen_ao` AS select `a`.`consecutivo` AS `folio_inventario`,`a`.`almacen` AS `almacen`,`a`.`zona` AS `zona`,`a`.`fecha_inicio` AS `fecha_inicio`,`a`.`fecha_final` AS `fecha_final`,`a`.`usuario` AS `usuario`,`a`.`status` AS `status`,`a`.`diferencia` AS `diferencia_texto`,sum(coalesce(`p`.`Cantidad`,0)) AS `piezas_contadas`,sum(coalesce(`p`.`Cantidad`,0) - coalesce(`p`.`ExistenciaTeorica`,0)) AS `diferencia_piezas`,sum(coalesce(`p`.`Cantidad`,0) * coalesce(`art`.`costoPromedio`,`art`.`imp_costo`,0)) AS `valor_inventariado`,sum((coalesce(`p`.`Cantidad`,0) - coalesce(`p`.`ExistenciaTeorica`,0)) * coalesce(`art`.`costoPromedio`,`art`.`imp_costo`,0)) AS `valor_diferencia` from ((`v_administracioninventario` `a` left join `t_invpiezas` `p` on(`p`.`ID_Inventario` = `a`.`consecutivo`)) left join `c_articulo` `art` on(`art`.`cve_articulo` = `p`.`cve_articulo`)) group by `a`.`consecutivo`,`a`.`almacen`,`a`.`zona`,`a`.`fecha_inicio`,`a`.`fecha_final`,`a`.`usuario`,`a`.`status`,`a`.`diferencia` order by `a`.`fecha_inicio` desc',
  'v_kardex_bidireccional_v2' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_kardex_bidireccional_v2` AS select `tc`.`id` AS `tx_id`,`tc`.`fecha` AS `fecha_ts`,cast(`tc`.`fecha` as date) AS `fecha`,cast(`tc`.`fecha` as time) AS `hora`,`tm`.`nombre` AS `tipo_movimiento`,case when ucase(`tm`.`nombre`) like \\\'ENTRADA%\\\' then \\\'ENTRADA\\\' when ucase(`tm`.`nombre`) like \\\'SALIDA%\\\' then \\\'SALIDA\\\' when ucase(`tm`.`nombre`) like \\\'TRASPASO%\\\' or ucase(`tm`.`nombre`) like \\\'ACOMODO%\\\' then \\\'TRANSFERENCIA\\\' when ucase(`tm`.`nombre`) like \\\'AJUSTE%\\\' then \\\'AJUSTE\\\' else ucase(coalesce(`tm`.`nombre`,\\\'DESCONOCIDO\\\')) end AS `tipo_tx`,`tc`.`id_TipoMovimiento` AS `id_TipoMovimiento`,`tc`.`cve_articulo` AS `cve_articulo`,ifnull(`a`.`des_articulo`,\\\'\\\') AS `des_articulo`,nullif(`tc`.`cve_lote`,\\\'\\\') AS `lote`,`tc`.`Cve_Almac` AS `cve_almac`,ifnull(`ap`.`des_almac`,`tc`.`Cve_Almac`) AS `des_almac`,ifnull(`ap`.`zona`,\\\'\\\') AS `zona`,`tc`.`cve_usuario` AS `id_usuario`,ifnull(`u`.`nombre`,`tc`.`cve_usuario`) AS `operador`,`tc`.`stockinicial` AS `stockinicial`,`tc`.`cantidad` AS `cantidad`,`tc`.`ajuste` AS `ajuste`,case when ucase(`tm`.`nombre`) in (\\\'SALIDA\\\',\\\'BAJA\\\') then abs(coalesce(`tc`.`cantidad`,0)) when ucase(`tm`.`nombre`) like \\\'AJUSTE%\\\' and coalesce(`tc`.`cantidad`,0) < 0 then abs(`tc`.`cantidad`) when ucase(`tm`.`nombre`) in (\\\'TRANSFERENCIA\\\',\\\'ACOMODO\\\') then abs(coalesce(`tc`.`cantidad`,0)) else 0 end AS `mov_ori`,case when ucase(`tm`.`nombre`) = \\\'ENTRADA\\\' then abs(coalesce(`tc`.`cantidad`,0)) when ucase(`tm`.`nombre`) like \\\'AJUSTE%\\\' and coalesce(`tc`.`cantidad`,0) > 0 then `tc`.`cantidad` when ucase(`tm`.`nombre`) in (\\\'TRANSFERENCIA\\\',\\\'ACOMODO\\\') then abs(coalesce(`tc`.`cantidad`,0)) else 0 end AS `mov_dst`,case when ucase(`tm`.`nombre`) like \\\'ENTRADA%\\\' then 1 when ucase(`tm`.`nombre`) like \\\'SALIDA%\\\' then -1 when ucase(`tm`.`nombre`) like \\\'AJUSTE%\\\' then 0 when ucase(`tm`.`nombre`) like \\\'TRASPASO%\\\' then 0 else 0 end AS `signo`,`ap`.`empresa_id` AS `empresa_id`,`ap`.`clave_empresa` AS `empresa_clave`,`ap`.`empresa_nombre` AS `empresa_nombre`,`ap`.`empresa_rfc` AS `empresa_rfc`,cast(`lp`.`cve_proyecto` as char charset utf8mb4) AS `proyecto_lote`,cast(`lp`.`cve_proveedor` as char charset utf8mb4) AS `proveedor_lote`,cast(`pr2`.`des_proyecto` as char charset utf8mb4) AS `proyecto_lote_nombre`,cast(`pv`.`des_proveedor` as char charset utf8mb4) AS `proveedor_lote_nombre`,`tc`.`Referencia` AS `referencia`,`tc`.`origen` AS `origen`,`tc`.`destino` AS `destino`,`tc`.`Activo` AS `Activo`,`tc`.`Fec_Ingreso` AS `Fec_Ingreso`,`tc`.`Id_Motivo` AS `Id_Motivo` from (((((((`t_cardex` `tc` left join `t_tipomovimiento` `tm` on(cast(`tm`.`id_TipoMovimiento` as unsigned) = `tc`.`id_TipoMovimiento`)) left join `c_articulo` `a` on(md5(`a`.`cve_articulo`) = md5(`tc`.`cve_articulo`))) left join `v_almacen_compat` `ap` on(md5(`ap`.`clave`) = md5(`tc`.`Cve_Almac`))) left join `v_usuario_compat` `u` on(md5(`u`.`cve_usuario`) = md5(`tc`.`cve_usuario`))) left join `v_bi_lote_proyecto` `lp` on(cast(`lp`.`cve_articulo` as char charset utf8mb4) = cast(`tc`.`cve_articulo` as char charset utf8mb4) and cast(`lp`.`lote` as char charset utf8mb4) = cast(`tc`.`cve_lote` as char charset utf8mb4))) left join `v_bi_proyecto` `pr2` on(`pr2`.`cve_proyecto` = `lp`.`cve_proyecto`)) left join `v_bi_proveedor` `pv` on(`pv`.`cve_proveedor` = `lp`.`cve_proveedor`))',
  'v_kardex_doble_partida' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_kardex_doble_partida` AS select cast(`tc`.`id` as unsigned) AS `tx_id`,`tc`.`fecha` AS `fecha_hora`,case when ucase(`tm`.`nombre`) = \\\'ENTRADA\\\' then \\\'ENTRADA\\\' when ucase(`tm`.`nombre`) in (\\\'BAJA\\\',\\\'SALIDA\\\') then \\\'SALIDA\\\' when ucase(`tm`.`nombre`) in (\\\'ACOMODO\\\',\\\'TRANSFERENCIA\\\') then \\\'TRANSFERENCIA\\\' when ucase(`tm`.`nombre`) like \\\'AJUSTE%\\\' then \\\'AJUSTE\\\' else ucase(coalesce(`tm`.`nombre`,\\\'DESCONOCIDO\\\')) end AS `tipo_tx`,`tc`.`cve_articulo` AS `producto_id`,`art`.`des_articulo` AS `producto_nombre`,nullif(`tc`.`cve_lote`,\\\'\\\') AS `lote`,case when ucase(`tm`.`nombre`) in (\\\'SALIDA\\\',\\\'BAJA\\\') then abs(coalesce(`tc`.`cantidad`,0)) when ucase(`tm`.`nombre`) like \\\'AJUSTE%\\\' and coalesce(`tc`.`cantidad`,0) < 0 then abs(`tc`.`cantidad`) when ucase(`tm`.`nombre`) in (\\\'TRANSFERENCIA\\\',\\\'ACOMODO\\\') then abs(coalesce(`tc`.`cantidad`,0)) else 0 end AS `mov_ori`,case when ucase(`tm`.`nombre`) = \\\'ENTRADA\\\' then abs(coalesce(`tc`.`cantidad`,0)) when ucase(`tm`.`nombre`) like \\\'AJUSTE%\\\' and coalesce(`tc`.`cantidad`,0) > 0 then `tc`.`cantidad` when ucase(`tm`.`nombre`) in (\\\'TRANSFERENCIA\\\',\\\'ACOMODO\\\') then abs(coalesce(`tc`.`cantidad`,0)) else 0 end AS `mov_dst`,`tc`.`Cve_Almac` AS `alm_codigo`,`ca`.`des_almac` AS `zona_nombre`,`cap`.`nombre` AS `alm_nombre`,`cap`.`clave` AS `alm_clave`,coalesce(`cap`.`empresa_id`,`ca`.`empresa_id`,0) AS `empresa_id`,`cc`.`clave_empresa` AS `empresa_clave`,`cc`.`des_cia` AS `empresa_nombre`,`cc`.`des_rfc` AS `empresa_rfc`,`pr`.`Id` AS `proyecto_id`,`pr`.`Cve_Proyecto` AS `proyecto_clave`,`pr`.`Des_Proyecto` AS `proyecto_nombre`,`tc`.`Referencia` AS `Referencia`,`tc`.`cve_usuario` AS `cve_usuario`,`tc`.`origen` AS `origen`,`tc`.`destino` AS `destino`,`tc`.`stockinicial` AS `stockinicial`,`tc`.`ajuste` AS `ajuste`,`tc`.`id_TipoMovimiento` AS `id_TipoMovimiento`,`tc`.`Activo` AS `Activo`,`tc`.`Fec_Ingreso` AS `Fec_Ingreso`,`tc`.`Id_Motivo` AS `Id_Motivo` from ((((((`t_cardex` `tc` left join `t_tipomovimiento` `tm` on(`tm`.`id_TipoMovimiento` = `tc`.`id_TipoMovimiento`)) left join `c_almacen` `ca` on(convert(`ca`.`cve_almac` using utf8mb4) = convert(`tc`.`Cve_Almac` using utf8mb4))) left join `c_almacenp` `cap` on(convert(`cap`.`id` using utf8mb4) = convert(`tc`.`Cve_Almac` using utf8mb4) or convert(`cap`.`id` using utf8mb4) = convert(`ca`.`cve_almacenp` using utf8mb4))) left join `c_compania` `cc` on(`cc`.`empresa_id` = coalesce(`cap`.`empresa_id`,`ca`.`empresa_id`))) left join `c_articulo` `art` on(convert(`art`.`cve_articulo` using utf8mb4) = convert(`tc`.`cve_articulo` using utf8mb4) and `art`.`empresa_id` = coalesce(`cap`.`empresa_id`,`ca`.`empresa_id`))) left join `c_proyecto` `pr` on((convert(`pr`.`id_almacen` using utf8mb4) = convert(`cap`.`id` using utf8mb4) or convert(`pr`.`id_almacen` using utf8mb4) = convert(`ca`.`cve_almacenp` using utf8mb4) or convert(`pr`.`id_almacen` using utf8mb4) = convert(`tc`.`Cve_Almac` using utf8mb4)) and `pr`.`empresa_id` = coalesce(`cap`.`empresa_id`,`ca`.`empresa_id`)))',
  'v_kardex_enriquecido' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_kardex_enriquecido` AS select `k`.`id` AS `id`,`k`.`fecha` AS `fecha_ts`,cast(`k`.`fecha` as date) AS `fecha`,cast(`k`.`fecha` as time) AS `hora`,`tm`.`nombre` AS `tipo_mov_txt`,`k`.`cve_articulo` AS `cve_articulo`,ifnull(`a`.`des_articulo`,\\\'\\\') AS `desc_articulo`,`k`.`Cve_Almac` AS `cve_almac`,ifnull(`ap`.`des_almac`,`k`.`Cve_Almac`) AS `des_almac`,ifnull(`ap`.`zona`,\\\'\\\') AS `zona`,`k`.`cve_usuario` AS `id_usuario`,ifnull(`u`.`nombre`,`k`.`cve_usuario`) AS `operador`,`k`.`cantidad` AS `cantidad`,`k`.`cve_lote` AS `lote`,case when ucase(`tm`.`nombre`) like \\\'ENTRADA%\\\' then 1 when ucase(`tm`.`nombre`) like \\\'SALIDA%\\\' then -1 when ucase(`tm`.`nombre`) like \\\'AJUSTE%\\\' then 0 when ucase(`tm`.`nombre`) like \\\'TRASPASO%\\\' then 0 else 0 end AS `signo` from ((((`t_cardex` `k` left join `t_tipomovimiento` `tm` on(cast(`tm`.`id_TipoMovimiento` as unsigned) = `k`.`id_TipoMovimiento`)) left join `c_articulo` `a` on(md5(`a`.`cve_articulo`) = md5(`k`.`cve_articulo`))) left join `v_almacen_compat` `ap` on(md5(`ap`.`clave`) = md5(`k`.`Cve_Almac`))) left join `v_usuario_compat` `u` on(md5(`u`.`cve_usuario`) = md5(`k`.`cve_usuario`)))',
  'v_kardex_enriquecido_v2' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_kardex_enriquecido_v2` AS select `v`.`id` AS `id`,`v`.`fecha_ts` AS `fecha_ts`,`v`.`fecha` AS `fecha`,`v`.`hora` AS `hora`,`v`.`tipo_mov_txt` AS `tipo_mov_txt`,`v`.`cve_articulo` AS `cve_articulo`,`v`.`desc_articulo` AS `desc_articulo`,`v`.`cve_almac` AS `cve_almac`,`v`.`des_almac` AS `des_almac`,`v`.`zona` AS `zona`,`v`.`id_usuario` AS `id_usuario`,`v`.`operador` AS `operador`,`v`.`cantidad` AS `cantidad`,`v`.`lote` AS `lote`,`v`.`signo` AS `signo`,cast(`lp`.`cve_proyecto` as char charset utf8mb4) AS `cve_proyecto`,cast(`lp`.`cve_proveedor` as char charset utf8mb4) AS `cve_proveedor`,cast(`pr`.`des_proyecto` as char charset utf8mb4) AS `des_proyecto`,cast(`pv`.`des_proveedor` as char charset utf8mb4) AS `des_proveedor` from (((`v_kardex_enriquecido` `v` left join `v_bi_lote_proyecto` `lp` on(cast(`lp`.`cve_articulo` as char charset utf8mb4) = cast(`v`.`cve_articulo` as char charset utf8mb4) and cast(`lp`.`lote` as char charset utf8mb4) = cast(`v`.`lote` as char charset utf8mb4))) left join `v_bi_proyecto` `pr` on(`pr`.`cve_proyecto` = `lp`.`cve_proyecto`)) left join `v_bi_proveedor` `pv` on(`pv`.`cve_proveedor` = `lp`.`cve_proveedor`))',
  'v_kardex_enriquecido_v3' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_kardex_enriquecido_v3` AS select `vk`.`id` AS `id`,`vk`.`fecha_ts` AS `fecha_ts`,`vk`.`fecha` AS `fecha`,`vk`.`hora` AS `hora`,`vk`.`tipo_mov_txt` AS `tipo_mov_txt`,`vk`.`cve_articulo` AS `cve_articulo`,`vk`.`desc_articulo` AS `desc_articulo`,`vk`.`cve_almac` AS `cve_almac`,`vk`.`des_almac` AS `des_almac`,`vk`.`zona` AS `zona`,`vk`.`id_usuario` AS `id_usuario`,`vk`.`operador` AS `operador`,`vk`.`cantidad` AS `cantidad`,`vk`.`lote` AS `lote`,`vk`.`signo` AS `signo`,`vk`.`cve_proyecto` AS `cve_proyecto`,`vk`.`cve_proveedor` AS `cve_proveedor`,`vk`.`des_proyecto` AS `des_proyecto`,`vk`.`des_proveedor` AS `des_proveedor`,`p`.`Nombre` AS `ProveedorNombre`,`p`.`Empresa` AS `EmpresaProveedor`,case when `p`.`es_cliente` = 1 then \\\'SI\\\' else \\\'NO\\\' end AS `EsEmpresaProveedor` from (`v_kardex_enriquecido_v2` `vk` left join `c_proveedores` `p` on(`vk`.`cve_proveedor` collate utf8mb4_unicode_ci = `p`.`cve_proveedor` collate utf8mb4_unicode_ci))',
  'v_listap_detalle' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_listap_detalle` AS select `lp`.`id` AS `ListaId`,`lp`.`Lista` AS `NombreLista`,`lp`.`Tipo` AS `Tipo`,`lp`.`FechaIni` AS `FechaIni`,`lp`.`FechaFin` AS `FechaFin`,`lp`.`Cve_Almac` AS `Cve_Almac`,`lp`.`TipoServ` AS `TipoServ`,`lp`.`id_moneda` AS `id_moneda`,`d`.`id` AS `DetalleId`,`d`.`Cve_Articulo` AS `Cve_Articulo`,`d`.`PrecioMin` AS `PrecioMin`,`d`.`PrecioMax` AS `PrecioMax`,`d`.`Cve_Almac` AS `Cve_Almac_Det`,`d`.`ComisionPor` AS `ComisionPor`,`d`.`ComisionMon` AS `ComisionMon` from (`listap` `lp` join `detallelp` `d` on(`d`.`ListaId` = `lp`.`id`))',
  'v_log_operaciones' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_log_operaciones` AS select `t_log_operaciones`.`empresa_id` AS `empresa_id`,trim(`t_log_operaciones`.`modulo`) AS `modulo`,trim(`t_log_operaciones`.`usuario`) AS `usuario`,trim(`t_log_operaciones`.`operacion`) AS `operacion`,trim(`t_log_operaciones`.`dispositivo`) AS `dispositivo`,trim(`t_log_operaciones`.`observaciones`) AS `observaciones`,coalesce(str_to_date(trim(`t_log_operaciones`.`fecha`),\\\'%Y-%m-%d %H:%i:%s\\\'),str_to_date(trim(`t_log_operaciones`.`fecha`),\\\'%d/%m/%Y %H:%i:%s\\\'),str_to_date(trim(`t_log_operaciones`.`fecha`),\\\'%Y-%m-%d\\\'),str_to_date(trim(`t_log_operaciones`.`fecha`),\\\'%d/%m/%Y\\\')) AS `fecha_dt`,trim(`t_log_operaciones`.`fecha`) AS `fecha_raw` from `t_log_operaciones`',
  'v_lp_master' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_lp_master` AS select `ch`.`IDContenedor` AS `IDContenedor`,`ch`.`CveLP` AS `CveLP`,`ch`.`Clave_Contenedor` AS `Clave_Contenedor`,`ch`.`descripcion` AS `descripcion`,`ch`.`tipo` AS `tipo`,`ch`.`Permanente` AS `Permanente`,`ch`.`TipoGen` AS `TipoGen`,coalesce(`ex`.`existencia_total`,0) AS `existencia_total`,`u`.`CodigoCSD` AS `CodigoCSD`,`ca`.`des_almac` AS `zona_almacenaje`,`ap`.`id` AS `id_almacen`,`ap`.`clave` AS `clave_almacenp`,`ap`.`nombre` AS `nombre_almacen`,coalesce(`pc`.`total_contenedores`,0) AS `total_contenedores`,`pal`.`CveLP` AS `lp_pallet` from (((((((`c_charolas` `ch` left join (select `ts_existenciatarima`.`ntarima` AS `ntarima`,`ts_existenciatarima`.`cve_almac` AS `cve_almac`,sum(`ts_existenciatarima`.`existencia`) AS `existencia_total`,max(case when `ts_existenciatarima`.`existencia` > 0 then `ts_existenciatarima`.`idy_ubica` end) AS `idy_ubica` from `ts_existenciatarima` group by `ts_existenciatarima`.`ntarima`,`ts_existenciatarima`.`cve_almac`) `ex` on(`ex`.`ntarima` = `ch`.`IDContenedor`)) left join `c_ubicacion` `u` on(`u`.`idy_ubica` = `ex`.`idy_ubica`)) left join `c_almacen` `ca` on(`ca`.`cve_almac` = `u`.`cve_almac`)) left join `c_almacenp` `ap` on(`ap`.`id` = `ex`.`cve_almac`)) left join (select `ts_existenciacajas`.`nTarima` AS `nTarima`,count(distinct `ts_existenciacajas`.`Id_Caja`) AS `total_contenedores` from `ts_existenciacajas` group by `ts_existenciacajas`.`nTarima`) `pc` on(`pc`.`nTarima` = `ch`.`IDContenedor`)) left join (select `ts_existenciacajas`.`Id_Caja` AS `Id_caja`,max(`ts_existenciacajas`.`nTarima`) AS `nTarima_padre` from `ts_existenciacajas` group by `ts_existenciacajas`.`Id_Caja`) `cx` on(`cx`.`Id_caja` = `ch`.`IDContenedor`)) left join `c_charolas` `pal` on(`pal`.`IDContenedor` = `cx`.`nTarima_padre`))',
  'v_ocupacion_almacen_resumen' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_ocupacion_almacen_resumen` AS select `a`.`cve_almac` AS `cve_almac`,`a`.`des_almac` AS `des_almac`,count(`u`.`idy_ubica`) AS `total_ubicaciones`,sum(case when `te`.`idy_ubica` is not null then 1 else 0 end) AS `ubicaciones_utilizadas`,sum(case when `te`.`idy_ubica` is null then 1 else 0 end) AS `ubicaciones_libres`,round(sum(case when `te`.`idy_ubica` is not null then 1 else 0 end) / count(`u`.`idy_ubica`) * 100,2) AS `porcentaje_ocupacion` from ((`c_ubicacion` `u` join `c_almacen` `a` on(`a`.`cve_almac` = `u`.`cve_almac`)) left join `ts_existenciatarima` `te` on(`te`.`idy_ubica` = `u`.`idy_ubica` and `te`.`existencia` > 0 and `te`.`Activo` = 1)) where `u`.`Activo` = 1 group by `a`.`cve_almac`,`a`.`des_almac`',
  'v_ocupacion_almacen_tipos' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_ocupacion_almacen_tipos` AS select `a`.`cve_almac` AS `cve_almac`,`a`.`des_almac` AS `des_almac`,count(`u`.`idy_ubica`) AS `total_ubicaciones`,sum(`u`.`AcomodoMixto` = \\\'S\\\') AS `ubic_acomodo_mixto`,sum(`u`.`Reabasto` = \\\'S\\\') AS `ubic_reabasto`,sum(`u`.`picking` = \\\'S\\\') AS `ubic_picking`,sum(`u`.`AreaProduccion` = \\\'S\\\') AS `ubic_manufactura`,sum(`u`.`AreaStagging` = \\\'S\\\') AS `ubic_staging`,sum(`u`.`Ptl` = \\\'S\\\') AS `ubic_ptl`,sum(case when `te`.`idy_ubica` is not null then 1 else 0 end) AS `ubicaciones_utilizadas` from ((`c_ubicacion` `u` join `c_almacen` `a` on(`a`.`cve_almac` = `u`.`cve_almac`)) left join `ts_existenciatarima` `te` on(`te`.`idy_ubica` = `u`.`idy_ubica` and `te`.`existencia` > 0 and `te`.`Activo` = 1)) where `u`.`Activo` = 1 group by `a`.`cve_almac`,`a`.`des_almac`',
  'v_patio_tablero' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_patio_tablero` AS select `v`.`id_visita` AS `id_visita`,`v`.`id_transporte` AS `id_transporte`,`t`.`ID_Transporte` AS `id_transporte_cod`,`t`.`Nombre` AS `nombre_transporte`,`t`.`Placas` AS `placas`,`v`.`id_anden_actual` AS `id_anden_actual`,`v`.`estatus` AS `estatus_visita`,`v`.`fecha_llegada` AS `fecha_llegada`,`v`.`fecha_salida` AS `fecha_salida`,`c`.`id_cita` AS `id_cita`,`c`.`estatus` AS `estatus_cita`,case when `c`.`id_cita` is null then \\\'PENDIENTE\\\' when `c`.`estatus` in (\\\'PROGRAMADA\\\',\\\'CONFIRMADA\\\',\\\'EN_PROCESO\\\',\\\'CERRADA\\\') then \\\'OK\\\' when `c`.`estatus` in (\\\'CANCELADA\\\',\\\'NO_SHOW\\\') then \\\'ERROR\\\' else \\\'PENDIENTE\\\' end AS `etapa1_estado`,case when `v`.`fecha_llegada` is null then \\\'PENDIENTE\\\' when `v`.`estatus` in (\\\'EN_PATIO\\\',\\\'ASIGNADO_ANDEN\\\',\\\'EN_DESCARGA\\\',\\\'EN_CARGA\\\',\\\'ESPERA_SALIDA\\\',\\\'FINALIZADA\\\') then \\\'OK\\\' else \\\'PENDIENTE\\\' end AS `etapa2_estado`,(select case when count(0) = 0 then \\\'PENDIENTE\\\' when sum(case when `i`.`resultado_qa` = \\\'RECHAZADO\\\' then 1 else 0 end) > 0 then \\\'ERROR\\\' when sum(case when `i`.`usuario_autoriza` is null then 1 else 0 end) > 0 then \\\'REVISION\\\' else \\\'OK\\\' end from `t_patio_inspeccion` `i` where `i`.`id_visita` = `v`.`id_visita` and `i`.`tipo_inspeccion` = \\\'INGRESO\\\') AS `etapa3_estado`,(select case when count(0) = 0 then \\\'PENDIENTE\\\' when sum(case when `ca`.`estatus` = \\\'EN_PROCESO\\\' then 1 else 0 end) > 0 then \\\'EN_PROCESO\\\' when sum(case when `ca`.`estatus` = \\\'COMPLETADA\\\' then 1 else 0 end) > 0 then \\\'OK\\\' when sum(case when `ca`.`estatus` = \\\'CANCELADA\\\' then 1 else 0 end) > 0 then \\\'ERROR\\\' else \\\'PENDIENTE\\\' end from `t_patio_carga` `ca` where `ca`.`id_visita` = `v`.`id_visita`) AS `etapa4_estado` from ((`t_patio_visita` `v` left join `t_patio_cita` `c` on(`c`.`id_cita` = `v`.`id_cita`)) left join `t_transporte` `t` on(`t`.`id` = `v`.`id_transporte`))',
  'v_productividad_kardex_almacen' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_productividad_kardex_almacen` AS select `v`.`cve_almac` AS `cve_almac`,`v`.`des_almac` AS `des_almac`,count(0) AS `total_mov`,sum(case when ucase(`v`.`tipo_mov_txt`) like \\\'ENTRADA%\\\' then 1 else 0 end) AS `entradas`,sum(case when ucase(`v`.`tipo_mov_txt`) like \\\'SALIDA%\\\' then 1 else 0 end) AS `salidas`,sum(`v`.`signo` * `v`.`cantidad`) AS `balance_neto` from `v_kardex_enriquecido` `v` group by `v`.`cve_almac`,`v`.`des_almac` order by count(0) desc',
  'v_productividad_kardex_daily' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_productividad_kardex_daily` AS select `v`.`fecha` AS `fecha`,count(0) AS `total_mov`,sum(case when ucase(`v`.`tipo_mov_txt`) like \\\'ENTRADA%\\\' then 1 else 0 end) AS `entradas`,sum(case when ucase(`v`.`tipo_mov_txt`) like \\\'SALIDA%\\\' then 1 else 0 end) AS `salidas`,sum(`v`.`signo` * `v`.`cantidad`) AS `balance_neto` from `v_kardex_enriquecido` `v` group by `v`.`fecha` order by `v`.`fecha` desc',
  'v_productividad_kardex_topprod' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_productividad_kardex_topprod` AS select `v`.`cve_articulo` AS `cve_articulo`,`v`.`desc_articulo` AS `desc_articulo`,count(0) AS `movimientos`,sum(case when `v`.`signo` = 1 then `v`.`cantidad` else 0 end) AS `total_entrada`,sum(case when `v`.`signo` = -1 then `v`.`cantidad` else 0 end) AS `total_salida` from `v_kardex_enriquecido` `v` group by `v`.`cve_articulo`,`v`.`desc_articulo` order by count(0) desc',
  'v_productividad_kardex_usuario' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_productividad_kardex_usuario` AS select `v`.`id_usuario` AS `id_usuario`,`v`.`operador` AS `operador`,count(0) AS `total_mov`,sum(case when ucase(`v`.`tipo_mov_txt`) like \\\'ENTRADA%\\\' then 1 else 0 end) AS `entradas`,sum(case when ucase(`v`.`tipo_mov_txt`) like \\\'SALIDA%\\\' then 1 else 0 end) AS `salidas`,round(count(0) / nullif(count(distinct `v`.`fecha`),0),2) AS `prom_mov_por_dia` from `v_kardex_enriquecido` `v` group by `v`.`id_usuario`,`v`.`operador` order by count(0) desc',
  'v_rtm_admin' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_rtm_admin` AS select concat_ws(\\\'::\\\',`p`.`cve_articulo`,`p`.`Cve_Lote`,ifnull(`p`.`Cve_Ubicacion`,\\\'\\\'),ifnull(`p`.`ID_Proveedor`,\\\'\\\')) AS `id`,`p`.`cve_articulo` AS `cve_articulo`,`a`.`des_articulo` AS `des_articulo`,`p`.`Cve_Lote` AS `cve_lote`,`l`.`Caducidad` AS `caducidad`,`p`.`Cantidad` AS `CantPendiente`,`p`.`Cve_Ubicacion` AS `cve_ubicacion`,`p`.`ID_Proveedor` AS `ID_Proveedor`,`prov`.`cve_proveedor` AS `cve_proveedor`,`prov`.`Nombre` AS `proveedor` from (((`v_pendientesacomodo` `p` left join `c_articulo` `a` on(`a`.`cve_articulo` = `p`.`cve_articulo`)) left join `c_lotes` `l` on(`l`.`cve_articulo` = `p`.`cve_articulo` and `l`.`Lote` = `p`.`Cve_Lote`)) left join `c_proveedores` `prov` on(`prov`.`ID_Proveedor` = `p`.`ID_Proveedor`))',
  'v_rtm_entradas_det' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_rtm_entradas_det` AS select `h`.`empresa_id` AS `empresa_id`,`h`.`Fol_Folio` AS `folio_entrada`,`h`.`tipo` AS `tipo_entrada`,`h`.`id_ocompra` AS `numero_oc`,`h`.`Fol_OEP` AS `folio_erp`,`h`.`Fec_Entrada` AS `fecha_entrada`,`h`.`Cve_Almac` AS `cve_almacen`,`alm`.`nombre` AS `almacen`,`h`.`Cve_Proveedor` AS `cve_proveedor`,`h`.`Proveedor` AS `proveedor`,`h`.`ID_Protocolo` AS `ID_Protocolo`,`proto`.`descripcion` AS `protocolo`,`d`.`cve_articulo` AS `cve_articulo`,`art`.`des_articulo` AS `des_articulo`,`d`.`cve_lote` AS `cve_lote`,`lot`.`Caducidad` AS `caducidad`,`d`.`numero_serie` AS `numero_serie`,cast(`d`.`CantidadPedida` as decimal(18,4)) AS `CantidadPedida`,cast(`d`.`CantidadRecibida` as decimal(18,4)) AS `CantidadRecibida`,cast(`d`.`CantidadUbicada` as decimal(18,4)) AS `CantidadUbicada`,cast(`d`.`CantidadRecibida` as decimal(18,4)) - cast(`d`.`CantidadUbicada` as decimal(18,4)) AS `CantPendiente`,case when cast(`d`.`CantidadRecibida` as decimal(18,4)) > 0 then round(cast(`d`.`CantidadUbicada` as decimal(18,4)) / cast(`d`.`CantidadRecibida` as decimal(18,4)) * 100,2) else 0 end AS `pct_acomodado`,`ch`.`Clave_Contenedor` AS `Clave_Contenedor`,`ch`.`CveLP` AS `CveLP` from ((((((`th_entalmacen` `h` join `td_entalmacen` `d` on(`d`.`empresa_id` = `h`.`empresa_id` and `d`.`fol_folio` = `h`.`Fol_Folio`)) left join `c_articulo` `art` on(`art`.`cve_articulo` = `d`.`cve_articulo`)) left join `c_lotes` `lot` on(`lot`.`cve_articulo` = `d`.`cve_articulo` and `lot`.`Lote` = `d`.`cve_lote`)) left join `c_almacenp` `alm` on(`alm`.`clave` = `h`.`Cve_Almac`)) left join `t_protocolo` `proto` on(`proto`.`ID_Protocolo` = `h`.`ID_Protocolo`)) left join `c_charolas` `ch` on(`ch`.`Pedido` = `h`.`Fol_Folio`)) where cast(`d`.`CantidadRecibida` as decimal(18,4)) > cast(`d`.`CantidadUbicada` as decimal(18,4)) order by `h`.`Fec_Entrada`,`h`.`Fol_Folio`,`d`.`cve_articulo`,`d`.`cve_lote`',
  'v_secuencia_surtido_admin' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_secuencia_surtido_admin` AS select `s`.`id` AS `id`,`s`.`clave_sec` AS `clave_sec`,`s`.`nombre` AS `nombre`,`s`.`tipo_sec` AS `tipo_sec`,`s`.`proceso` AS `proceso`,`s`.`almacen_id` AS `almacen_id`,`ap`.`clave` AS `almacen_clave`,`ap`.`nombre` AS `almacen_nombre`,count(distinct `d`.`id`) AS `ubicaciones_asignadas`,coalesce(group_concat(distinct concat(`u`.`cve_usuario`,\\\' - \\\',`u`.`nombre_completo`) order by `u`.`nombre_completo` ASC separator \\\', \\\'),\\\'\\\') AS `usuarios_asignados` from ((((`c_secuencia_surtido` `s` join `c_almacenp` `ap` on(`ap`.`id` = `s`.`almacen_id`)) left join `c_secuencia_surtido_det` `d` on(`d`.`sec_id` = `s`.`id` and `d`.`activo` = 1)) left join `c_secuencia_surtido_usuario` `su` on(`su`.`sec_id` = `s`.`id` and `su`.`activo` = 1)) left join `c_usuario` `u` on(`u`.`id_user` = `su`.`usuario_id`)) where `s`.`activo` = 1 group by `s`.`id`,`s`.`clave_sec`,`s`.`nombre`,`s`.`tipo_sec`,`s`.`proceso`,`s`.`almacen_id`,`ap`.`clave`,`ap`.`nombre`',
  'v_secuencia_surtido_detalle' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_secuencia_surtido_detalle` AS select `d`.`id` AS `id`,`d`.`sec_id` AS `sec_id`,`s`.`nombre` AS `nombre_secuencia`,`d`.`orden` AS `orden`,`u`.`idy_ubica` AS `ubicacion_id`,`u`.`CodigoCSD` AS `bl`,`u`.`cve_pasillo` AS `pasillo`,`u`.`cve_rack` AS `rack`,`u`.`cve_nivel` AS `nivel`,`u`.`Seccion` AS `seccion`,`u`.`Ubicacion` AS `posicion` from ((`c_secuencia_surtido_det` `d` join `c_secuencia_surtido` `s` on(`s`.`id` = `d`.`sec_id`)) join `c_ubicacion` `u` on(`u`.`idy_ubica` = `d`.`ubicacion_id`)) where `d`.`activo` = 1 order by `s`.`id`,`d`.`orden`',
  'v_stg_bom_actual' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_stg_bom_actual` AS select `a`.`empresa_id` AS `empresa_id`,`a`.`Cve_Articulo` AS `Cve_Articulo`,`art`.`des_articulo` AS `DescripcionPadre`,`a`.`Cve_ArtComponente` AS `Cve_ArtComponente`,`comp`.`des_articulo` AS `DescripcionComponente`,`a`.`Cantidad` AS `Cantidad`,`a`.`cve_umed` AS `cve_umed`,`a`.`Etapa` AS `Etapa` from ((`stg_t_artcompuesto` `a` join `stg_c_articulo` `art` on(`a`.`Cve_Articulo` = `art`.`cve_articulo` and `a`.`empresa_id` = `art`.`empresa_id`)) join `stg_c_articulo` `comp` on(`a`.`Cve_ArtComponente` = `comp`.`cve_articulo` and `a`.`empresa_id` = `comp`.`empresa_id`))',
  'v_usuario_compat' => 'CREATE ALGORITHM=UNDEFINED   VIEW `v_usuario_compat` AS select cast(`c_usuario`.`id_user` as signed) AS `id_usuario`,coalesce(`c_usuario`.`nombre_completo`,`c_usuario`.`des_usuario`,`c_usuario`.`cve_usuario`) AS `nombre`,`c_usuario`.`cve_usuario` AS `cve_usuario`,`c_usuario`.`email` AS `email`,`c_usuario`.`perfil` AS `perfil`,`c_usuario`.`Activo` AS `Activo` from `c_usuario`',
));
        foreach ($views as $view) {
            DB::statement("DROP VIEW IF EXISTS `$view`");
        }
    }
};